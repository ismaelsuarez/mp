<!doctype html>
<html lang="es">
<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<title>MP ‚Äì Configuraci√≥n</title>
	<link rel="stylesheet" href="style.css" />
    <script src="https://cdn.tailwindcss.com"></script>
    
</head>
<body class="text-slate-200">
    <div class="container">
        <div class="flex items-center justify-between mb-2">
            <div class="flex items-center gap-3">
                <img id="brandLogo" src="nombre_tc.png" alt="TODO-COMPUTACION" class="h-12 select-none" />
                <span id="activePerfilTag" class="hidden ml-8 px-2 py-0.5 rounded text-xs border border-slate-600 bg-slate-800 text-slate-200"></span>
            </div>
            <div class="flex items-center gap-2">
                <button id="btnOpenLogs" class="px-3 py-1.5 rounded-md bg-slate-700 text-white border-0 hover:bg-slate-600">Abrir log de hoy</button>
                <button id="btnOpenCaja" class="px-4 py-2 rounded-md bg-emerald-600 text-white border-0 hover:bg-emerald-500">Modo Caja</button>
                <button id="btnOpenImagen" class="px-4 py-2 rounded-md bg-blue-600 text-white border-0 hover:bg-blue-500">Modo Imagen</button>
            </div>
        </div>
        <div class="tabs">
            <button class="tab active" data-tab="config">Configuraci√≥n</button>
            <button class="tab" data-tab="results">Resultados</button>
            <button class="tab" data-tab="history">Historial</button>
            <button class="tab" data-tab="about">Acerca de</button>
        </div>

        <section id="tab-config" class="tab-pane active">
            <div id="perfilPermWarning" class="hidden mb-3 px-3 py-2 rounded-md border border-amber-600 bg-amber-900/40 text-amber-200 text-sm"></div>
			<form id="configForm" class="form-grid">
				<!-- Perfiles de Configuraci√≥n (prioridad visual) -->
				<details id="perfiles-config-primary" class="group mb-4 border border-sky-700 rounded-md">
					<summary class="cursor-pointer px-3 py-2 bg-sky-800 rounded-t-md text-sm font-semibold select-none text-white">
						üß© Perfiles de Configuraci√≥n
					</summary>
					<div class="p-3 space-y-3">
						<div>
							<label class="block text-sm mb-1" for="perfilSelect">Seleccionar Perfil</label>
							<select id="perfilSelect" class="w-full bg-slate-900 border border-slate-700 rounded-md px-3 py-2 text-sm text-slate-100"></select>
							<div id="perfilSelectedTag" class="mt-1 text-xs text-slate-300"></div>
						</div>
						<div class="flex flex-wrap gap-2">
							<button type="button" id="btnPerfilAplicar" class="px-3 py-1.5 text-sm rounded-md bg-blue-600 text-white border-0 hover:bg-blue-500">Aplicar perfil</button>
							<button type="button" id="btnPerfilGuardarNuevo" class="px-3 py-1.5 text-sm rounded-md bg-emerald-600 text-white border-0 hover:bg-emerald-500">Guardar como nuevo</button>
							<button type="button" id="btnPerfilEditar" class="px-3 py-1.5 text-sm rounded-md bg-yellow-500 text-black border-0 hover:bg-yellow-400">Editar</button>
							<button type="button" id="btnPerfilExportar" class="px-3 py-1.5 text-sm rounded-md bg-purple-600 text-white border-0 hover:bg-purple-500">Exportar</button>
							<button type="button" id="btnPerfilImportar" class="px-3 py-1.5 text-sm rounded-md bg-indigo-600 text-white border-0 hover:bg-indigo-500">Importar</button>
							<input type="file" id="perfilImportFile" accept="application/json,.json" class="hidden" />
						</div>
						<div>
							<div class="text-sm font-semibold mb-1">Vista previa del perfil</div>
							<pre id="perfilPreview" class="bg-slate-900 border border-slate-700 rounded-md p-2 text-xs overflow-auto" style="max-height:220px"></pre>
						</div>
					</div>
				</details>

				<!-- Comprobantes (agrupa Recibos y Remitos) -->
				<details id="sec-comprobantes" class="group mb-4 border border-slate-700 rounded-md">
					<summary class="cursor-pointer px-3 py-2 bg-slate-800 rounded-t-md text-sm font-semibold select-none">Comprobantes</summary>
					<div class="p-3 space-y-6">
						<!-- Recibos (PV y Numeraci√≥n) -->
						<details id="sec-recibos" class="group border border-slate-700 rounded-md">
							<summary class="cursor-pointer px-3 py-2 bg-slate-800 rounded-t-md text-sm font-semibold select-none">Recibos</summary>
							<div class="p-3 space-y-3">
								<div class="grid grid-cols-1 md:grid-cols-3 gap-3 items-end">
									<label>Punto de venta (PV)
										<input id="REC_PV" type="number" placeholder="1" />
									</label>
									<label>N√∫mero inicial (NI)
										<input id="REC_NI" type="number" placeholder="1" />
									</label>
									<label class="text-sm">Siguiente n√∫mero
										<input id="REC_NEXT" type="text" readonly />
									</label>
								</div>
								<div class="grid grid-cols-1 md:grid-cols-3 gap-3 items-end">
									<label>Ruta Local (obligatoria)
										<input id="REC_OUT_LOCAL" placeholder="C:\\1_AFIP" />
									</label>
									<label>Ruta Red 1 (opcional)
										<input id="REC_OUT_RED1" placeholder="\\\\correo\\backup\\Presupuestos y Licitaciones\\FACTURAS" />
									</label>
									<label>Ruta Red 2 (opcional)
										<input id="REC_OUT_RED2" placeholder="\\\\server2008\\backup\\Presupuestos y Licitaciones\\FACTURAS" />
									</label>
								</div>
								<div class="grid grid-cols-1 md:grid-cols-3 gap-3 items-end">
									<label>Impresora para Recibos (opcional)
										<select id="REC_PRINTER"></select>
									</label>
									<label>Test impresi√≥n
										<button type="button" id="btnReciboTestPrint" class="w-full px-3 py-1.5 text-sm rounded-md bg-slate-700 text-white border-0 hover:bg-slate-600">Probar</button>
									</label>
								</div>
								<div class="flex items-center gap-2">
									<button type="button" id="btnReciboGuardar" class="px-3 py-1.5 text-sm rounded-md bg-emerald-600 text-white border-0 hover:bg-emerald-500">Guardar Recibo</button>
									<span id="reciboStatus" class="text-xs text-slate-400"></span>
								</div>
							</div>
						</details>

						<!-- Remitos (PV y Numeraci√≥n) -->
						<details id="sec-remitos" class="group border border-slate-700 rounded-md">
							<summary class="cursor-pointer px-3 py-2 bg-slate-800 rounded-t-md text-sm font-semibold select-none">Remitos</summary>
							<div class="p-3 space-y-3">
								<div class="grid grid-cols-1 md:grid-cols-3 gap-3 items-end">
									<label>Punto de venta (PV)
										<input id="REM_PV" type="number" placeholder="1" />
									</label>
									<label>N√∫mero inicial (NI)
										<input id="REM_NI" type="number" placeholder="1" />
									</label>
									<label class="text-sm">Siguiente n√∫mero
										<input id="REM_NEXT" type="text" readonly />
									</label>
								</div>
								<div class="grid grid-cols-1 md:grid-cols-3 gap-3 items-end">
									<label>Ruta Local (obligatoria)
										<input id="REM_OUT_LOCAL" placeholder="C:\\1_AFIP" />
									</label>
									<label>Ruta Red 1 (opcional)
										<input id="REM_OUT_RED1" placeholder="\\\\correo\\backup\\Presupuestos y Licitaciones\\FACTURAS" />
									</label>
									<label>Ruta Red 2 (opcional)
										<input id="REM_OUT_RED2" placeholder="\\\\server2008\\backup\\Presupuestos y Licitaciones\\FACTURAS" />
									</label>
								</div>
								<div class="grid grid-cols-1 md:grid-cols-3 gap-3 items-end">
									<label>Impresora para Remitos (opcional)
										<select id="REM_PRINTER"></select>
									</label>
								</div>
								<div class="flex items-center gap-2">
									<button type="button" id="btnRemitoGuardar" class="px-3 py-1.5 text-sm rounded-md bg-emerald-600 text-white border-0 hover:bg-emerald-500">Guardar Remito</button>
									<span id="remitoStatus" class="text-xs text-slate-400"></span>
								</div>
							</div>
						</details>

					<!-- Facturas A/B y Notas (unificado) -->
					<details id="sec-facturas-ab" class="group border border-slate-700 rounded-md">
						<summary class="cursor-pointer px-3 py-2 bg-slate-800 rounded-t-md text-sm font-semibold select-none">Facturas A/B y Notas</summary>
                        <div class="p-3 space-y-3">
							<div class="grid grid-cols-1 md:grid-cols-3 gap-3 items-end">
								<label>Ruta Local (obligatoria)
									<input id="FAC_OUT_LOCAL" placeholder="C:\\1_AFIP" />
								</label>
								<label>Ruta Red 1 (opcional)
									<input id="FAC_OUT_RED1" placeholder="\\\\correo\\backup\\Presupuestos y Licitaciones\\FACTURAS" />
								</label>
								<label>Ruta Red 2 (opcional)
									<input id="FAC_OUT_RED2" placeholder="\\\\server2008\\backup\\Presupuestos y Licitaciones\\FACTURAS" />
								</label>
							</div>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-3 items-end">
                                <label>Impresora (opcional)
                                    <select id="FAC_PRINTER"></select>
                                </label>
                            </div>
                            <div class="flex items-center gap-2">
                                <button type="button" id="btnFacturasSave" class="px-3 py-1.5 text-sm rounded-md bg-emerald-600 text-white border-0 hover:bg-emerald-500">Guardar</button>
                                <span id="facturasStatus" class="text-xs text-slate-400"></span>
                            </div>
						</div>
					</details>
					</div>
				</details>

				<details id="sec-mercado-pago" class="group mb-4 border border-slate-700 rounded-md">
					<summary class="cursor-pointer px-3 py-2 bg-slate-800 rounded-t-md text-sm font-semibold select-none">
						Mercado Pago
					</summary>
					<div class="p-3 space-y-3 overflow-visible">
						<p class="text-xs text-slate-400">Completa tu Access Token y par√°metros de b√∫squeda. Puedes <strong>probar la conexi√≥n</strong> para verificar que todo est√© correcto.</p>

						<!-- Credenciales -->
						<div>
							<label class="block text-sm mb-1">Access Token (Mercado Pago)</label>
							<div class="flex items-center gap-2">
								<input id="MP_ACCESS_TOKEN" type="password" class="flex-1" />
								<button type="button" id="btnToggleToken" class="px-2 py-1 text-xs rounded border border-slate-600 hover:bg-slate-700">üëÅ Mostrar</button>
							</div>
							<p class="text-xs text-slate-500 mt-1">Usa un token de producci√≥n <code>APP_USR-‚Ä¶</code>. No compartas este valor.</p>
						</div>

						<label>ID de usuario (opcional) <input id="MP_USER_ID" /></label>
						<div class="row">
							<button type="button" id="btnTest" class="bg-blue-600 text-white border-transparent">Probar conexi√≥n</button>
							<span id="testStatus"></span>
						</div>

						<!-- Ventana operativa -->
						<div class="grid grid-cols-1 md:grid-cols-2 gap-3">
							<label class="md:col-span-2">Zona horaria <input id="MP_TZ" placeholder="America/Argentina/Buenos_Aires" /></label>
							<div class="md:col-span-2">
								<label class="block text-sm mb-1">Ventana operativa (HH:mm)</label>
								<div class="flex items-center gap-2">
									<input id="MP_WINDOW_START" type="time" class="w-24 text-center" placeholder="00:00" />
									<span class="text-sm">a</span>
									<input id="MP_WINDOW_END" type="time" class="w-24 text-center" placeholder="23:59" />
								</div>
							</div>
						</div>
						<p class="text-xs text-slate-500 -mt-2">Define el d√≠a operativo en tu zona horaria. Se sugiere 00:00 a 23:59.</p>

						<!-- Rango manual (opcional) -->
						<div class="grid grid-cols-1 md:grid-cols-2 gap-3">
							<label>Desde (fecha) <input id="MP_DATE_FROM" placeholder="YYYY-MM-DD" /></label>
							<label>Hasta (fecha) <input id="MP_DATE_TO" placeholder="YYYY-MM-DD" /></label>
						</div>
						<div class="row">
							<label class="checkbox">
								<input id="MP_NO_DATE_FILTER" type="checkbox" /> Sin filtro de fechas
							</label>
							<label>D√≠as hacia atr√°s (por defecto)
								<input id="MP_DAYS_BACK" type="number" min="1" step="1" placeholder="7" />
							</label>
						</div>
						<p class="text-xs text-slate-500 -mt-2">Si completas fechas, se ignora "D√≠as hacia atr√°s". "Sin filtro" trae todo (solo diagn√≥stico).</p>

						<!-- B√∫squeda y paginaci√≥n -->
						<div class="grid grid-cols-1 md:grid-cols-3 gap-3">
							<label>Campo de fecha
								<select id="MP_RANGE" class="w-full">
									<option value="date_last_updated">√öltima actualizaci√≥n</option>
									<option value="date_created">Creaci√≥n</option>
									<option value="date_approved">Aprobaci√≥n</option>
								</select>
							</label>
							<label>Estado (opcional)
								<select id="MP_STATUS" class="w-full">
									<option value="">Todos</option>
									<option value="approved">Aprobado</option>
									<option value="refunded">Reintegrada</option>
									<option value="cancelled">Cancelado</option>
									<option value="in_process">En proceso</option>
									<option value="pending">Pendiente</option>
									<option value="charged_back">Contracargo</option>
								</select>
							</label>
							<label>L√≠mite por p√°gina <input id="MP_LIMIT" type="number" min="1" step="1" placeholder="50" /></label>
							<label>P√°ginas m√°ximas <input id="MP_MAX_PAGES" type="number" min="1" step="1" placeholder="100" /></label>
						</div>
						<p class="text-xs text-slate-500 -mt-2">"Campo de fecha" define qu√© timestamp usa el filtro (sugerido: "√öltima actualizaci√≥n"). "Estado" permite elegir un estado espec√≠fico o "Todos".</p>
					</div>
				</details>
                            
				<details id="sec-facturacion" class="group mb-4 border border-slate-700 rounded-md">
					<summary class="cursor-pointer px-3 py-2 bg-slate-800 rounded-t-md text-sm font-semibold select-none">
						Email / SMTP
					</summary>
					<div class="p-3 space-y-3">
						<label>Email para reportes
							<input id="EMAIL_REPORT" placeholder="correo@dominio.com" />
						</label>
						<p id="EMAIL_REPORT_HELP" class="text-xs text-slate-500">Destinatario que recibir√° los reportes por email.</p>

						<div class="grid grid-cols-1 md:grid-cols-3 gap-3">
							<label class="md:col-span-2">Servidor SMTP
								<input id="SMTP_HOST" placeholder="smtp.gmail.com" />
							</label>
							<label>Puerto
								<input id="SMTP_PORT" type="number" placeholder="587" />
							</label>
						</div>
						<p class="text-xs text-slate-500 -mt-2">Ejemplo Gmail: host <code>smtp.gmail.com</code>, puerto <code>587</code> (STARTTLS). Revisa la configuraci√≥n de tu proveedor.</p>

						<div class="grid grid-cols-1 md:grid-cols-2 gap-3">
							<label>Usuario
								<input id="SMTP_USER" placeholder="tu_email@dominio" />
							</label>
							<label>Contrase√±a
								<div class="relative">
									<input id="SMTP_PASS" type="password" class="w-full pr-8" />
									<button type="button" id="btnToggleSmtpPass" class="absolute right-2 top-1/2 -translate-y-1/2 text-xs px-1 py-0.5 rounded border border-slate-600 hover:bg-slate-700" title="Mostrar/Ocultar">üëÅ</button>
								</div>
							</label>
						</div>
					</div>
				</details>

				<!-- Grupo: FTP-Configuraciones (contiene subpaneles FTP Cliente, MP, WhatsApp y Servidor) -->
				<details id="sec-ftp-config" class="group mb-4 border border-slate-700 rounded-md">
					<summary class="cursor-pointer px-3 py-2 bg-slate-800 rounded-t-md text-sm font-semibold select-none">
						FTP-Configuraciones
					</summary>
                    <div class="p-3 space-y-3">
                <!-- Subpanel: FTP-Server (1) -->
                <details class="group mb-4 border border-slate-700 rounded-md">
                    <summary class="cursor-pointer px-3 py-2 bg-slate-800 rounded-t-md text-sm font-semibold select-none">1) FTP-Server (carpeta local)</summary>
                    <div class="p-3 space-y-3">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                            <label>Host <input id="FTP_SRV_HOST" placeholder="0.0.0.0" /></label>
                            <label>Puerto <input id="FTP_SRV_PORT" type="number" placeholder="2121" /></label>
                            <label>Usuario <input id="FTP_SRV_USER" placeholder="user" /></label>
                            <label>Contrase√±a <input id="FTP_SRV_PASS" type="password" placeholder="pass" /></label>
                            <label class="md:col-span-2">Carpeta ra√≠z <input id="FTP_SRV_ROOT" placeholder="C:\\tmp\\ftp_share" /></label>
                            <label>PASV Host (IP anunciada)
                                <input id="FTP_SRV_PASV_HOST" placeholder="IP LAN o P√∫blica (ej. 192.168.x.x)" />
                            </label>
                            <label>Rango PASV (m√≠n)
                                <input id="FTP_SRV_PASV_MIN" type="number" placeholder="50000" />
                            </label>
                            <label>Rango PASV (m√°x)
                                <input id="FTP_SRV_PASV_MAX" type="number" placeholder="50100" />
                            </label>
                        </div>
                        <p class="text-xs text-slate-500">Host: deja 0.0.0.0 para escuchar en todas las IPs de esta PC. Usa 127.0.0.1 para solo local, o tu IP LAN (ej. 192.168.x.x) para restringir.</p>
                        <p class="text-xs text-slate-500">Puerto: por defecto 2121. Usa 21 solo si no hay otro servicio activo en ese puerto (IIS/FileZilla) y el firewall lo permite.</p>
                        <p class="text-xs text-slate-500">PASV: si hay firewalls/NAT o clientes externos, define PASV Host (IP LAN o p√∫blica) y abre el Rango en el firewall/router.</p>
                        <label class="checkbox inline-flex items-center gap-2"><input id="FTP_SRV_ENABLED" type="checkbox" /> Habilitado (autoarranque)</label>
                        <div class="flex items-center gap-2 flex-wrap">
                            <button type="button" id="btnFtpSrvToggle" class="px-3 py-1.5 text-sm rounded-md bg-emerald-600 text-white border-0 hover:bg-emerald-500">Iniciar servidor FTP</button>
                            <button type="button" id="btnFtpCopyUrl" class="px-2.5 py-1 text-xs rounded-md bg-slate-700 text-white border border-slate-600 hover:bg-slate-600">Copiar URL</button>
                            <button type="button" id="btnFtpOpenRoot" class="px-2.5 py-1 text-xs rounded-md bg-slate-700 text-white border border-slate-600 hover:bg-slate-600">Abrir carpeta</button>
                            <span id="ftpSrvStatus" class="text-xs text-slate-400"></span>
                        </div>
                    </div>
                </details>

                <!-- Subpanel: FTP Cliente (2) -->
                <details class="group mb-4 border border-slate-700 rounded-md">
                    <summary class="cursor-pointer px-3 py-2 bg-slate-800 rounded-t-md text-sm font-semibold select-none">2) FTP-Cliente (env√≠os generales y comprobantes)</summary>
					<div class="p-3 space-y-3">
						<!-- Host / Puerto -->
						<div class="grid grid-cols-1 md:grid-cols-3 gap-3">
							<label class="md:col-span-2">IP o Host
								<input id="FTP_IP" placeholder="192.168.0.10" />
							</label>
							<label>Puerto
								<input id="FTP_PORT" type="number" placeholder="21" />
							</label>
						</div>
						<p class="text-xs text-slate-500 -mt-2">Puerto por defecto: 21. Si tu servidor exige TLS expl√≠cito, marca FTPS.</p>

						<!-- FTPS -->
						<label class="checkbox inline-flex items-center gap-2"><input id="FTP_SECURE" type="checkbox" /> Usar FTPS (expl√≠cito)</label>

						<!-- Credenciales -->
						<div class="grid grid-cols-1 md:grid-cols-3 gap-3 items-end">
							<label class="md:col-span-1">Usuario
								<input id="FTP_USER" placeholder="usuario" />
							</label>
							<label class="md:col-span-1">Contrase√±a
								<input id="FTP_PASS" type="password" placeholder="********" />
							</label>
							<div class="md:col-span-1">
								<button type="button" id="btnToggleFtpPass" class="px-2 py-1 text-xs rounded border border-slate-600 hover:bg-slate-700 w-full">üëÅ Mostrar</button>
							</div>
						</div>

						<!-- Rutas remotas -->
						<label>Carpeta remota
							<input id="FTP_DIR" placeholder="/reportes" />
						</label>
						<label>Archivo remoto (DBF)
							<input id="FTP_FILE" placeholder="mp.dbf o transactions-detailed-YYYY-MM-DD.dbf" />
						</label>
						<p class="text-xs text-slate-500 -mt-2">Si dejas vac√≠o, el sistema enviar√° el archivo fijo <code>mp.dbf</code> (generado autom√°ticamente).</p>

						<!-- Probar -->
						<div class="row">
							<button type="button" id="btnTestFtp" class="bg-blue-600 text-white border-transparent">Probar FTP</button>
							<span id="ftpTestStatus"></span>
						</div>
						<!-- Guardar configuraci√≥n FTP Cliente -->
						<div class="flex items-center gap-2">
							<button type="button" id="btnSaveFtp" class="px-3 py-1.5 text-sm rounded-md bg-emerald-600 text-white border-0 hover:bg-emerald-500">Guardar FTP Cliente</button>
							<span id="ftpSaveStatus" class="text-xs text-slate-400"></span>
						</div>
						<!-- Enviar archivo arbitrario por FTP -->
						<div class="row">
							<input id="FTP_SEND_FILE_PATH" type="text" placeholder="Selecciona archivo local..." class="flex-1" readonly />
							<button type="button" id="btnPickLocalFile" class="text-xs px-2 py-1 rounded border border-slate-600 hover:bg-slate-700">Elegir archivo</button>
							<button type="button" id="btnSendLocalFile" class="text-xs px-2 py-1 rounded bg-emerald-600 text-white border border-emerald-700 hover:bg-emerald-500">Enviar archivo por FTP</button>
						</div>
					</div>
				</details>

                <!-- Subpanel: FTP Mercado Pago (4) -->
                <details id="sec-ftp-mp" class="group mb-4 border border-slate-700 rounded-md">
                    <summary class="cursor-pointer px-3 py-2 bg-slate-800 rounded-t-md text-sm font-semibold select-none">4) FTP-Mercado Pago (env√≠o .dbf)</summary>
					<div class="p-3 space-y-3">
						<div class="text-xs text-slate-400">Configuraci√≥n exclusiva para el env√≠o del archivo <code>mp.dbf</code> de Mercado Pago a un servidor distinto del FTP general.</div>
					<div class="grid grid-cols-1 md:grid-cols-3 gap-3">
						<label class="md:col-span-2">IP o Host
								<input id="MP_FTP_IP" placeholder="192.168.0.30" />
							</label>
						<label>Puerto
							<input id="MP_FTP_PORT" type="number" placeholder="21" />
							</label>
						</div>
						<label class="checkbox inline-flex items-center gap-2"><input id="MP_FTP_SECURE" type="checkbox" /> Usar FTPS (expl√≠cito)</label>
						<div class="grid grid-cols-1 md:grid-cols-3 gap-3 items-end">
							<label>Usuario
								<input id="MP_FTP_USER" placeholder="usuario" />
							</label>
							<label>Contrase√±a
								<input id="MP_FTP_PASS" type="password" placeholder="********" />
							</label>
							<div>
								<button type="button" id="btnToggleMpFtpPass" class="px-2 py-1 text-xs rounded border border-slate-600 hover:bg-slate-700 w-full">üëÅ Mostrar</button>
							</div>
						</div>
						<label>Carpeta remota
							<input id="MP_FTP_DIR" placeholder="/reportes-mp" />
						</label>
						<div class="row">
							<button type="button" id="btnTestMpFtp" class="bg-blue-600 text-white border-transparent">Probar FTP MP</button>
							<span id="ftpMpTestStatus"></span>
						</div>
						<div class="row">
							<button type="button" id="btnSendMpDbf" class="text-xs px-2 py-1 rounded bg-emerald-600 text-white border border-emerald-700 hover:bg-emerald-500">Enviar mp.dbf (FTP MP)</button>
						</div>
						<div class="flex items-center gap-2 mt-1">
							<button type="button" id="btnSaveMpFtp" class="px-3 py-1.5 text-sm rounded-md bg-emerald-600 text-white border-0 hover:bg-emerald-500">Guardar FTP Mercado Pago</button>
							<span id="mpFtpSaveStatus" class="text-xs text-slate-400"></span>
						</div>
					</div>
				</details>

                <!-- Subpanel: FTP WhatsApp (3) -->
                <details class="group mb-4 border border-slate-700 rounded-md">
                    <summary class="cursor-pointer px-3 py-2 bg-slate-800 rounded-t-md text-sm font-semibold select-none">3) FTP-WhatsApp (env√≠o .txt a servidor nube)</summary>
					<div class="p-3 space-y-3">
						<div class="grid grid-cols-1 md:grid-cols-3 gap-3">
							<label class="md:col-span-2">IP o Host
								<input id="FTP_WHATSAPP_IP" placeholder="192.168.0.20" />
							</label>
							<label>Puerto
								<input id="FTP_WHATSAPP_PORT" type="number" placeholder="21" />
							</label>
						</div>
						<label class="checkbox inline-flex items-center gap-2"><input id="FTP_WHATSAPP_SECURE" type="checkbox" /> Usar FTPS (expl√≠cito)</label>
						<label class="checkbox inline-flex items-center gap-2"><input id="FTP_WHATSAPP_SFTP" type="checkbox" checked disabled /> Modo fijo: SFTP (SSH)</label>
						<div class="grid grid-cols-1 md:grid-cols-3 gap-3 items-end">
							<label>Usuario
								<input id="FTP_WHATSAPP_USER" placeholder="user" />
							</label>
							<label>Contrase√±a
								<input id="FTP_WHATSAPP_PASS" type="password" placeholder="********" />
							</label>
							<div>
								<button type="button" id="btnToggleFtpWPass" class="px-2 py-1 text-xs rounded border border-slate-600 hover:bg-slate-700 w-full">üëÅ Mostrar</button>
							</div>
						</div>
						<label>Carpeta remota
							<input id="FTP_WHATSAPP_DIR" placeholder="/whatsapp" />
						</label>
						<div class="row">
							<button type="button" id="btnTestFtpWhatsapp" class="bg-blue-600 text-white border-transparent">Probar FTP WhatsApp</button>
							<span id="ftpWhatsappTestStatus"></span>
						</div>
						<div class="flex items-center gap-2 mt-1">
							<button type="button" id="btnSaveWhatsappCfg" class="px-3 py-1.5 text-sm rounded-md bg-emerald-600 text-white border-0 hover:bg-emerald-500">Guardar WhatsApp</button>
							<span id="waSaveStatus" class="text-xs text-slate-400"></span>
						</div>
						<div class="row">
							<input id="FTP_WA_SEND_FILE_PATH" type="text" placeholder="Selecciona archivo local..." class="flex-1" readonly />
							<button type="button" id="btnPickLocalFileWa" class="text-xs px-2 py-1 rounded border border-slate-600 hover:bg-slate-700">Elegir archivo</button>
							<button type="button" id="btnSendLocalFileWa" class="text-xs px-2 py-1 rounded bg-emerald-600 text-white border border-emerald-700 hover:bg-emerald-500">Enviar archivo por FTP WhatsApp</button>
						</div>
					</div>
				</details>

                <!-- Subpanel: FTP SERVER (1, movido al inicio del grupo) -->
                <details class="group mb-4 border border-slate-700 rounded-md hidden">
                    <summary class="cursor-pointer px-3 py-2 bg-slate-800 rounded-t-md text-sm font-semibold select-none">1) FTP-Server (carpeta local)</summary>
					<div class="p-3 space-y-3">
						<div class="grid grid-cols-1 md:grid-cols-2 gap-3">
							<label>Host <input id="FTP_SRV_HOST" placeholder="0.0.0.0" /></label>
							<label>Puerto <input id="FTP_SRV_PORT" type="number" placeholder="2121" /></label>
							<label>Usuario <input id="FTP_SRV_USER" placeholder="user" /></label>
							<label>Contrase√±a <input id="FTP_SRV_PASS" type="password" placeholder="pass" /></label>
							<label class="md:col-span-2">Carpeta ra√≠z <input id="FTP_SRV_ROOT" placeholder="C:\\tmp\\ftp_share" /></label>
							<label>PASV Host (IP anunciada)
								<input id="FTP_SRV_PASV_HOST" placeholder="IP LAN o P√∫blica (ej. 192.168.x.x)" />
							</label>
							<label>Rango PASV (m√≠n)
								<input id="FTP_SRV_PASV_MIN" type="number" placeholder="50000" />
							</label>
							<label>Rango PASV (m√°x)
								<input id="FTP_SRV_PASV_MAX" type="number" placeholder="50100" />
							</label>
						</div>
						<p class="text-xs text-slate-500">Host: deja 0.0.0.0 para escuchar en todas las IPs de esta PC. Usa 127.0.0.1 para solo local, o tu IP LAN (ej. 192.168.x.x) para restringir.</p>
						<p class="text-xs text-slate-500">Puerto: por defecto 2121. Usa 21 solo si no hay otro servicio activo en ese puerto (IIS/FileZilla) y el firewall lo permite.</p>
						<p class="text-xs text-slate-500">PASV: si hay firewalls/NAT o clientes externos, define <strong>PASV Host</strong> (IP LAN o p√∫blica) y abre el <strong>Rango</strong> en el firewall/router. Sugerido: 50000‚Äì50100.</p>
						<p class="text-xs text-slate-500">Carpeta ra√≠z: se crear√° autom√°ticamente si no existe. Lo que coloques aqu√≠ ser√° lo que ver√°n los clientes al conectarse.</p>
						<p class="text-xs text-emerald-400">Nota: este <strong>Servidor FTP</strong> no usa intervalos ni temporizadores: queda a la espera y atiende conexiones entrantes. Los intervalos pertenecen √∫nicamente al <strong>Cliente FTP</strong> (env√≠o saliente).</p>
						<label class="checkbox inline-flex items-center gap-2"><input id="FTP_SRV_ENABLED" type="checkbox" /> Habilitado (autoarranque)</label>
						<div class="flex items-center gap-2 flex-wrap">
							<button type="button" id="btnFtpSrvToggle" class="px-3 py-1.5 text-sm rounded-md bg-emerald-600 text-white border-0 hover:bg-emerald-500">Iniciar servidor FTP</button>
							<button type="button" id="btnFtpCopyUrl" class="px-2.5 py-1 text-xs rounded-md bg-slate-700 text-white border border-slate-600 hover:bg-slate-600">Copiar URL</button>
							<button type="button" id="btnFtpOpenRoot" class="px-2.5 py-1 text-xs rounded-md bg-slate-700 text-white border border-slate-600 hover:bg-slate-600">Abrir carpeta</button>
							<span id="ftpSrvStatus" class="text-xs text-slate-400"></span>
						</div>
						<p class="text-xs text-slate-400">El servidor FTP se ejecuta en paralelo, valida credenciales y expone la carpeta ra√≠z configurada.</p>
					</div>
				</details>
				</div>
				</details>

				<details class="group mb-4 border border-slate-700 rounded-md">
					<summary class="cursor-pointer px-3 py-2 bg-slate-800 rounded-t-md text-sm font-semibold select-none">
						üè¶ Banco Galicia
					</summary>
					<div class="p-3 space-y-3">
						<p class="text-xs text-slate-400">Configura las credenciales para conectarte a la API de Banco Galicia. Puedes <strong>probar la conexi√≥n</strong> para verificar que todo est√© correcto.</p>

						<!-- Credenciales -->
						<div>
							<label class="block text-sm mb-1">App ID (Galicia)</label>
							<input id="GALICIA_APP_ID" type="text" class="w-full" placeholder="tu_app_id" />
							<p class="text-xs text-slate-500 mt-1">ID de aplicaci√≥n proporcionado por Banco Galicia.</p>
						</div>

						<div>
							<label class="block text-sm mb-1">App Key (Galicia)</label>
							<div class="flex items-center gap-2">
								<input id="GALICIA_APP_KEY" type="password" class="flex-1" placeholder="tu_app_key" />
								<button type="button" id="btnToggleGaliciaKey" class="px-2 py-1 text-xs rounded border border-slate-600 hover:bg-slate-700">üëÅ Mostrar</button>
							</div>
							<p class="text-xs text-slate-500 mt-1">Clave de aplicaci√≥n proporcionada por Banco Galicia.</p>
						</div>

						<div>
							<label class="block text-sm mb-1">Certificado (.pem)</label>
							<input id="GALICIA_CERT_PATH" type="text" class="w-full" placeholder="C:\\ruta\\cert.pem" />
							<p class="text-xs text-slate-500 mt-1">Ruta al archivo de certificado p√∫blico.</p>
						</div>

						<div>
							<label class="block text-sm mb-1">Clave privada (.pem)</label>
							<input id="GALICIA_KEY_PATH" type="text" class="w-full" placeholder="C:\\ruta\\key.pem" />
							<p class="text-xs text-slate-500 mt-1">Ruta al archivo de clave privada.</p>
						</div>

						<div>
							<label class="block text-sm mb-1">Entorno</label>
							<select id="GALICIA_ENVIRONMENT" class="w-full">
								<option value="sandbox">Sandbox (Pruebas)</option>
								<option value="production">Producci√≥n</option>
							</select>
							<p class="text-xs text-slate-500 mt-1">Selecciona el entorno de la API de Galicia.</p>
						</div>

						<div class="flex items-center gap-2">
							<button type="button" id="btnTestGalicia" class="bg-blue-600 text-white border-transparent">Probar conexi√≥n Galicia</button>
							<span id="galiciaTestStatus"></span>
						</div>

						<div class="flex items-center gap-2">
							<button type="button" id="btnOpenGalicia" class="bg-emerald-600 text-white border-transparent">Abrir m√≥dulo Galicia</button>
						</div>
					</div>
				</details>

				<details class="group mb-4 border border-slate-700 rounded-md">
					<summary class="cursor-pointer px-3 py-2 bg-slate-800 rounded-t-md text-sm font-semibold select-none">
						üìÑ Facturaci√≥n (AFIP) (en construcci√≥n)
					</summary>
					<div class="p-3 space-y-4">
						<!-- Empresa -->
						<div class="border border-slate-700 rounded-md p-3 bg-slate-800/40">
							<div class="text-sm font-semibold mb-2">Datos de la empresa</div>
							<div class="grid grid-cols-1 md:grid-cols-2 gap-3">
								<label>Raz√≥n social
									<input id="EMP_RAZON" placeholder="Mi Empresa S.A." />
								</label>
								<label>CUIT
									<input id="EMP_CUIT" placeholder="20123456789" />
								</label>
								<label class="md:col-span-2">Domicilio
									<input id="EMP_DOM" placeholder="Calle 123, Ciudad" />
								</label>
								<label>Condici√≥n IVA
									<select id="EMP_IVA">
										<option value="RI">Responsable Inscripto</option>
										<option value="MT">Monotributo</option>
										<option value="EX">Exento</option>
										<option value="CF">Consumidor Final</option>
									</select>
								</label>
								<label>Logo (ruta)
									<input id="EMP_LOGO" placeholder="C:\\ruta\\logo.png" />
								</label>
							</div>
							<div class="flex items-center gap-2 mt-2">
								<button type="button" id="btnEmpresaGuardar" class="px-3 py-1.5 text-sm rounded-md bg-emerald-600 text-white border-0 hover:bg-emerald-500">Guardar empresa</button>
								<span id="empresaStatus" class="text-xs text-slate-400"></span>
							</div>
						</div>

						<!-- Par√°metros de Facturaci√≥n -->
						<div class="border border-slate-700 rounded-md p-3 bg-slate-800/40">
							<div class="text-sm font-semibold mb-2">Par√°metros</div>
							<div class="grid grid-cols-1 md:grid-cols-3 gap-3">
								<label>Tipo por defecto
									<select id="FAC_TIPO_DEF">
										<option value="FA">Factura A</option>
										<option value="FB">Factura B</option>
										<option value="FC">Factura C</option>
										<option value="NC">Nota de cr√©dito A/B</option>
										<option value="NC_C">Nota de cr√©dito C</option>
										<option value="RECIBO">Recibo</option>
									</select>
								</label>
								<label>Punto de venta
									<input id="FAC_PTO_VTA_DEF" type="number" placeholder="1" />
								</label>
								<label>Numeraci√≥n
									<input id="FAC_NUM_DEF" type="number" placeholder="1" />
								</label>
							</div>
							<div class="grid grid-cols-1 md:grid-cols-3 gap-3 mt-2">
								<label class="checkbox inline-flex items-center gap-2"><input id="FAC_EMISOR_MIPYME" type="checkbox" /> Emisor es MiPyME</label>
								<label>Umbral FCE (monto)
									<input id="FAC_FCE_UMBRAL" type="number" step="0.01" placeholder="3958316" />
								</label>
							</div>
							<div class="flex items-center gap-2 mt-2">
								<button type="button" id="btnParamGuardar" class="px-3 py-1.5 text-sm rounded-md bg-emerald-600 text-white border-0 hover:bg-emerald-500">Guardar par√°metros</button>
								<span id="paramStatus" class="text-xs text-slate-400"></span>
							</div>
						</div>
						<div class="grid grid-cols-1 md:grid-cols-2 gap-3">
							<label>CUIT Emisor
								<input id="AFIP_CUIT" placeholder="20123456789" />
							</label>
							<label>Punto de Venta
								<input id="AFIP_PTO_VTA" type="number" placeholder="1" />
							</label>
							<label>Certificado (.crt/.pem)
								<input id="AFIP_CERT_PATH" placeholder="C:\\ruta\\cert.pem" />
								<div class="mt-1 text-xs text-slate-400">Deja vac√≠o para usar Importaci√≥n Segura</div>
							</label>
							<label>Clave privada (.key)
								<input id="AFIP_KEY_PATH" placeholder="C:\\ruta\\key.pem" />
								<div class="mt-1 text-xs text-slate-400">Deja vac√≠o para usar Importaci√≥n Segura</div>
							</label>
							<label>Entorno
								<select id="AFIP_ENTORNO">
									<option value="homologacion">Homologaci√≥n</option>
									<option value="produccion">Producci√≥n</option>
								</select>
							</label>
						</div>
						<!-- Importaci√≥n segura integrada en AFIP (CUIT Emisor) -->
						<div class="mt-2">
							<div class="text-xs font-semibold mb-1">Importar Cert/Key</div>
							<div class="flex flex-wrap items-center gap-2">
								<input id="secureImportCert" type="text" placeholder="Ruta .crt/.pem" class="w-56 px-2 py-1 text-xs bg-slate-700 border border-slate-600 rounded text-white" />
								<input id="secureImportKey" type="text" placeholder="Ruta .key/.pem" class="w-56 px-2 py-1 text-xs bg-slate-700 border border-slate-600 rounded text-white" />
								<button type="button" id="btnSecureImport" class="px-2 py-1 text-xs rounded-md bg-slate-600 text-white border-0 hover:bg-slate-500">Importar seguro</button>
							</div>
							<div class="text-[11px] text-slate-400 mt-1">Si usas Importaci√≥n Segura, deja vac√≠os los campos de Certificado y Clave para activar el modo 100% seguro.</div>
						</div>
						<div class="flex items-center gap-2">
							<button type="button" id="btnAfipGuardar" class="px-3 py-1.5 text-sm rounded-md bg-emerald-600 text-white border-0 hover:bg-emerald-500">Guardar configuraci√≥n AFIP</button>
							<span id="afipCfgStatus" class="text-xs text-slate-400"></span>
						</div>
						<div class="border-t border-slate-700 pt-3">
							<div class="flex items-center justify-between mb-2">
								<h4 class="text-sm font-semibold">Facturas emitidas</h4>
								<div class="flex items-center gap-2 text-xs">
									<input id="AFIP_FILTRO_DESDE" placeholder="Desde (YYYY-MM-DD)" class="w-40" />
									<input id="AFIP_FILTRO_HASTA" placeholder="Hasta (YYYY-MM-DD)" class="w-40" />
									<button type="button" id="btnAfipBuscar" class="px-2 py-1 rounded border border-slate-600 hover:bg-slate-700">Buscar</button>
								</div>
							</div>
							<table id="tablaFacturasAfip" class="w-full text-xs">
								<thead>
									<tr class="text-left text-slate-400">
										<th class="py-1">Fecha</th>
										<th class="py-1">Pto Vta</th>
										<th class="py-1">Tipo</th>
										<th class="py-1">N√∫mero</th>
										<th class="py-1">Receptor</th>
										<th class="py-1">Total</th>
										<th class="py-1">CAE</th>
										<th class="py-1">PDF</th>
									</tr>
								</thead>
								<tbody></tbody>
							</table>
						</div>

						<!-- Pruebas de Facturaci√≥n -->
						<div class="border-t border-slate-700 pt-3">
							<div class="mb-2">
								<h4 class="text-sm font-semibold text-blue-300">üß™ Pruebas de Facturaci√≥n</h4>
								<p class="text-xs text-slate-400">Secci√≥n para realizar pruebas de emisi√≥n de facturas en modo homologaci√≥n</p>
							</div>
							
							<div class="bg-slate-800/40 border border-slate-700 rounded-md p-3 mb-3">
								<!-- Configuraci√≥n AFIP -->
								<div class="grid grid-cols-2 md:grid-cols-4 gap-2 mb-3">
									<label class="text-xs">
										Tipo de Comprobante:
										<select id="pruebaFacturaTipoCbte" class="w-full px-2 py-1 text-xs bg-slate-700 border border-slate-600 rounded text-white">
											<option value="1">Factura A (1)</option>
											<option value="6">Factura B (6)</option>
											<option value="11" selected>Factura C (11)</option>
											<option value="19">Factura E (19)</option>
											<option value="2">Nota de D√©bito A (2)</option>
											<option value="7">Nota de D√©bito B (7)</option>
											<option value="12">Nota de D√©bito C (12)</option>
											<option value="3">Nota de Cr√©dito A (3)</option>
											<option value="8">Nota de Cr√©dito B (8)</option>
											<option value="13">Nota de Cr√©dito C (13)</option>
											<option value="4">Recibo (4)</option>
										</select>
									</label>
									<label class="text-xs">
										Concepto:
										<select id="pruebaFacturaConcepto" class="w-full px-2 py-1 text-xs bg-slate-700 border border-slate-600 rounded text-white">
											<option value="1" selected>Productos</option>
											<option value="2">Servicios</option>
											<option value="3">Productos y Servicios</option>
										</select>
									</label>
									<label class="text-xs">
										Tipo de Documento:
										<select id="pruebaFacturaDocTipo" class="w-full px-2 py-1 text-xs bg-slate-700 border border-slate-600 rounded text-white">
											<option value="80" selected>CUIT</option>
											<option value="86">CUIL</option>
											<option value="87">CDI</option>
											<option value="96">DNI</option>
											<option value="99">Consumidor Final</option>
										</select>
									</label>
									<label class="text-xs">
										Moneda:
										<select id="pruebaFacturaMoneda" class="w-full px-2 py-1 text-xs bg-slate-700 border border-slate-600 rounded text-white">
											<option value="PES" selected>PES - Peso Argentino</option>
											<option value="DOL">DOL - D√≥lar Estadounidense</option>
											<option value="EUR">EUR - Euro</option>
										</select>
									</label>
									<label class="text-xs">
										MiPyME ‚Äì ModoFin:
										<select id="pruebaFacturaModoFin" class="w-full px-2 py-1 text-xs bg-slate-700 border border-slate-600 rounded text-white">
											<option value="">(No FCE)</option>
											<option value="ADC">ADC</option>
											<option value="SCA">SCA</option>
										</select>
									</label>
								</div>
								<label class="checkbox inline-flex items-center gap-2 mb-2"><input id="chkValidarPadron13" type="checkbox" /> Validar Padr√≥n 13 antes de emitir</label>
								
								<!-- Datos del Cliente -->
								<div class="grid grid-cols-2 gap-2 mb-3">
									<label class="text-xs">
										CUIT Cliente:
										<input type="text" id="pruebaFacturaCuit" placeholder="20300123456" class="w-full px-2 py-1 text-xs bg-slate-700 border border-slate-600 rounded text-white">
									</label>
									<label class="text-xs">
										Raz√≥n Social:
										<input type="text" id="pruebaFacturaRazon" placeholder="Cliente Demo S.A." class="w-full px-2 py-1 text-xs bg-slate-700 border border-slate-600 rounded text-white">
									</label>
									<label class="text-xs">
										Condici√≥n IVA Receptor:
										<select id="pruebaFacturaCondIvaRec" class="w-full px-2 py-1 text-xs bg-slate-700 border border-slate-600 rounded text-white">
											<option value="RI">Responsable Inscripto (1)</option>
											<option value="MT">Monotributo (6)</option>
											<option value="MONOTRIBUTO SOCIAL">Monotributista Social (13)</option>
											<option value="MONOTRIBUTO TRABAJADOR INDEPENDIENTE PROMOVIDO">Monotributo Trab. Indep. Promovido (16)</option>
											<option value="EX">Exento (4)</option>
											<option value="SNC">Sujeto No Categorizado (7)</option>
											<option value="PROVEEDOR DEL EXTERIOR">Proveedor del Exterior (8)</option>
											<option value="CLIENTE DEL EXTERIOR">Cliente del Exterior (9)</option>
											<option value="LIBERADO 19640">IVA Liberado ‚Äì Ley 19.640 (10)</option>
											<option value="NO ALCANZADO">IVA No Alcanzado (15)</option>
											<option value="CF" selected>Consumidor Final (5)</option>
										</select>
									</label>
									<label class="text-xs">
										C√≥digo ARCA (IVARECEPTOR):
										<input type="text" id="pruebaFacturaIvaRecCod" readonly class="w-full px-2 py-1 text-xs bg-slate-800 border border-slate-700 rounded text-slate-200" />
									</label>
								</div>

								<!-- Verificaciones manuales -->
								<div class="flex items-center gap-2 mb-3 flex-wrap">
									<button type="button" id="btnValidarPadron13Manual" class="px-2 py-1 text-xs rounded-md bg-slate-700 text-white border border-slate-600 hover:bg-slate-600">Validar Padr√≥n 13</button>
									<button type="button" id="btnPingPadron13" class="px-2 py-1 text-xs rounded-md bg-slate-700 text-white border border-slate-600 hover:bg-slate-600">Verificar Padr√≥n 13</button>
									<button type="button" id="btnPreverMiPymeManual" class="px-2 py-1 text-xs rounded-md bg-slate-700 text-white border border-slate-600 hover:bg-slate-600">Previsualizar MiPyME</button>
									<span id="padron13StatusManual" class="text-xs text-slate-300"></span>
									<span id="mipymeStatusManual" class="text-xs text-slate-300"></span>
								</div>

								<!-- Panel de estado visual -->
								<div class="mb-3 p-2 rounded border border-slate-700 bg-slate-800/40">
									<div class="flex items-center gap-2 flex-wrap">
										<span class="text-xs">Estado:</span>
										<span id="statusPadronChip" class="px-2 py-0.5 text-xs rounded border border-slate-600 bg-slate-900 text-slate-200">Padr√≥n 13: ‚Äî</span>
										<button type="button" id="btnTogglePadronDetail" class="px-2 py-0.5 text-xs rounded border border-slate-600 bg-slate-900 text-slate-200">Ver detalle</button>
										<span id="statusMipymeChip" class="px-2 py-0.5 text-xs rounded border border-slate-600 bg-slate-900 text-slate-200">MiPyME: ‚Äî</span>
										<span id="statusReadyChip" class="px-2 py-0.5 text-xs rounded border border-slate-600 bg-slate-900 text-slate-200">Listo para emitir: ‚Äî</span>
									</div>
									<div class="mt-2 flex items-center gap-2 flex-wrap text-xs">
										<span id="a13LastStatus" class="px-2 py-0.5 rounded border border-slate-600 bg-slate-900 text-slate-200">A13: ‚Äî</span>
										<label class="inline-flex items-center gap-1">
											<input id="a13AutoEnabled" type="checkbox" checked /> Auto
										</label>
										<label class="inline-flex items-center gap-1">cada
											<input id="a13AutoMinutes" type="number" min="1" step="1" value="5" class="w-14 text-center px-1 py-0.5 bg-slate-900 border border-slate-700 rounded" /> min
										</label>
									</div>
									<pre id="padron13Detail" class="mt-2 hidden text-[11px] bg-slate-900 border border-slate-700 rounded p-2 max-h-40 overflow-auto"></pre>
								</div>
								
								<!-- Tabla de Items -->
								<div class="mb-3">
									<div class="flex items-center justify-between mb-2">
										<span class="text-xs font-semibold">Items de la Factura:</span>
										<button type="button" id="btnAgregarItem" class="px-2 py-1 text-xs rounded-md bg-emerald-600 text-white border-0 hover:bg-emerald-500">+ Agregar Item</button>
									</div>
									
									<div class="overflow-x-auto">
										<table id="tablaItemsPrueba" class="w-full text-xs">
											<thead class="bg-slate-700">
												<tr>
													<th class="px-2 py-1 text-left">Descripci√≥n</th>
													<th class="px-2 py-1 text-left">Cantidad</th>
													<th class="px-2 py-1 text-left">Precio Unit.</th>
													<th class="px-2 py-1 text-left">IVA %</th>
													<th class="px-2 py-1 text-left">Subtotal</th>
													<th class="px-2 py-1 text-left">Acci√≥n</th>
												</tr>
											</thead>
											<tbody id="tbodyItemsPrueba">
												<!-- Items se agregar√°n din√°micamente -->
											</tbody>
											<tfoot class="bg-slate-700/50">
												<tr>
													<td colspan="4" class="px-2 py-1 text-right font-semibold">Total Neto:</td>
													<td id="totalNetoPrueba" class="px-2 py-1 font-semibold">$0.00</td>
													<td></td>
												</tr>
												<tr>
													<td colspan="4" class="px-2 py-1 text-right font-semibold">Total IVA:</td>
													<td id="totalIvaPrueba" class="px-2 py-1 font-semibold">$0.00</td>
													<td></td>
												</tr>
												<tr>
													<td colspan="4" class="px-2 py-1 text-right font-semibold text-blue-300">Total Final:</td>
													<td id="totalFinalPrueba" class="px-2 py-1 font-semibold text-blue-300">$0.00</td>
													<td></td>
												</tr>
											</tfoot>
										</table>
									</div>
								</div>
								
								<!-- Botones de Acci√≥n -->
								<div class="flex items-center flex-wrap gap-2">
									<button type="button" id="btnPruebaEmitir" class="px-3 py-1.5 text-sm rounded-md bg-blue-600 text-white border-0 hover:bg-blue-500">Emitir Factura de Prueba</button>
									<button type="button" id="btnAsociarComprobante" class="px-3 py-1.5 text-sm rounded-md bg-slate-700 text-white border border-slate-600 hover:bg-slate-600 hidden">Asociar Comprobante</button>
									<button type="button" id="btnVerificarEstado" class="px-3 py-1.5 text-sm rounded-md bg-green-600 text-white border-0 hover:bg-green-500">Verificar Estado AFIP</button>
									<button type="button" id="btnValidarCertificado" class="px-3 py-1.5 text-sm rounded-md bg-yellow-600 text-white border-0 hover:bg-yellow-500">Validar Certificado</button>
									<button type="button" id="btnAfipClearTA" class="px-3 py-1.5 text-sm rounded-md bg-amber-700 text-white border-0 hover:bg-amber-600" title="Borrar token/TA y forzar relogin">Borrar TA / Relogin</button>
									<button type="button" id="btnAfipClearCfg" class="px-3 py-1.5 text-sm rounded-md bg-orange-700 text-white border-0 hover:bg-orange-600" title="Borrar configuraci√≥n AFIP (cert/key/cuit/pto vta/entorno)">Borrar Config AFIP</button>
									<button type="button" id="btnDbReset" class="px-3 py-1.5 text-sm rounded-md bg-red-700 text-white border-0 hover:bg-red-600" title="Eliminar base y regenerar esquema">Resetear Base</button>
									<button type="button" id="btnListPtosVta" class="px-3 py-1.5 text-sm rounded-md bg-purple-600 text-white border-0 hover:bg-purple-500">Listar Puntos de Venta</button>
									<button type="button" id="btnLimpiarItems" class="px-3 py-1.5 text-sm rounded-md bg-red-600 text-white border-0 hover:bg-red-500">Limpiar Items</button>
									<button type="button" id="btnIdemList" class="px-3 py-1.5 text-sm rounded-md bg-slate-700 text-white border border-slate-600 hover:bg-slate-600" title="Listar comprobantes en proceso">Listar pendientes</button>
									<button type="button" id="btnIdemCleanup" class="px-3 py-1.5 text-sm rounded-md bg-rose-700 text-white border-0 hover:bg-rose-600" title="Limpiar idempotencia y liberar bloqueos">Limpiar idempotencia</button>
									<!-- Checklist compacto -->
									<div class="ml-2 flex items-center gap-2 text-xs">
										<button type="button" id="btnChecklist" class="px-2 py-1 text-xs rounded border border-slate-600 bg-slate-800 hover:bg-slate-700">Revisar</button>
										<span id="chkPadron" class="px-1.5 py-0.5 rounded border border-slate-600 text-slate-300">‚Ä¢ Padr√≥n</span>
										<span id="chkMiPyme" class="px-1.5 py-0.5 rounded border border-slate-600 text-slate-300">‚Ä¢ MiPyME</span>
										<span id="chkItems" class="px-1.5 py-0.5 rounded border border-slate-600 text-slate-300">‚Ä¢ Items</span>
										<span id="chkReady" class="px-1.5 py-0.5 rounded border border-slate-600 text-slate-300">‚Ä¢ Listo</span>
									</div>
								</div>
								<div id="pruebaStatus" class="mt-2 text-xs"></div>
								<pre id="afipPtosVtaStatus" class="mt-2 text-[11px] bg-slate-900 border border-slate-700 rounded p-2 overflow-auto" style="max-height:160px"></pre>
							</div>
						</div>

						<!-- Historial de PDFs en Documentos/facturas -->
						<div class="border-t border-slate-700 pt-3">
							<div class="flex items-center justify-between mb-2">
								<h4 class="text-sm font-semibold">Historial local de PDFs</h4>
								<button type="button" id="btnPdfsRefresh" class="px-2 py-1 text-xs rounded border border-slate-600 hover:bg-slate-700">Refrescar</button>
							</div>
							<ul id="listaPdfsAfip" class="text-xs space-y-1"></ul>
						</div>
					</div>

					<!-- Watcher .fac -->
					<div class="border border-slate-700 rounded-md p-3 bg-slate-800/40">
						<div class="text-sm font-semibold mb-2">Disparo por archivo .fac (FTP)</div>
						<p class="text-xs text-slate-400 mb-2">Cuando est√° activo, el sistema observa una carpeta local y, al llegar un archivo <code>.fac</code>, notifica a la UI para depuraci√≥n. Pr√≥ximamente, mapear√° estos archivos a comprobantes.</p>
						<div class="grid grid-cols-1 md:grid-cols-3 gap-3 items-end">
							<label class="md:col-span-2">Carpeta a observar
								<input id="FAC_WATCH_DIR" placeholder="C:\\tmp" />
							</label>
							<label class="checkbox inline-flex items-center gap-2"><input id="FAC_WATCH_ENABLED" type="checkbox" /> Activar</label>
						</div>
						<div class="flex items-center gap-2 mt-2 text-xs">
							<button type="button" id="btnFacWatcherSave" class="px-2 py-1 rounded border border-slate-600 hover:bg-slate-700">Guardar</button>
							<span id="facWatcherStatus" class="text-slate-400"></span>
						</div>
						<pre id="facWatcherLog" class="mt-2 hidden text-[11px] bg-slate-900 border border-slate-700 rounded p-2 max-h-40 overflow-auto"></pre>
					</div>
				</details>

				<details class="group mb-4 border border-slate-700 rounded-md">
					<summary class="cursor-pointer px-3 py-2 bg-slate-800 rounded-t-md text-sm font-semibold select-none">
						Automatizaci√≥n
					</summary>
					<div class="p-3 space-y-2">
						<div class="flex items-center gap-2">
							<label class="text-sm">Intervalo (segundos)</label>
							<input id="AUTO_INTERVAL_SECONDS" type="number" placeholder="3600" min="1" step="1" class="w-24 text-center" />
						</div>
						
						<!-- Calendario semanal (unificado): D√≠a ‚Ä¢ Activo ‚Ä¢ Desde ‚Ä¢ Hasta -->
						<div class="mb-3">
							<label class="block text-sm font-medium mb-2">Calendario semanal de ejecuci√≥n</label>
							<div class="grid grid-cols-1 gap-2">
								<div class="grid grid-cols-12 items-center gap-2 text-xs text-slate-400">
									<div class="col-span-4 md:col-span-3">D√≠a</div>
									<div class="col-span-2 md:col-span-2">Activo</div>
									<div class="col-span-3 md:col-span-3">Desde</div>
									<div class="col-span-3 md:col-span-3">Hasta</div>
								</div>
								<!-- Lunes -->
								<div class="grid grid-cols-12 items-center gap-2">
									<div class="col-span-4 md:col-span-3 text-sm">Lunes</div>
									<div class="col-span-2 md:col-span-2"><input id="AUTO_DAYS_MONDAY" type="checkbox" checked /></div>
									<div class="col-span-3 md:col-span-3"><input id="AUTO_FROM_MONDAY" type="time" class="w-24 sm:w-28 text-center" /></div>
									<div class="col-span-3 md:col-span-3"><input id="AUTO_TO_MONDAY" type="time" class="w-24 sm:w-28 text-center" /></div>
								</div>
								<!-- Martes -->
								<div class="grid grid-cols-12 items-center gap-2">
									<div class="col-span-4 md:col-span-3 text-sm">Martes</div>
									<div class="col-span-2 md:col-span-2"><input id="AUTO_DAYS_TUESDAY" type="checkbox" checked /></div>
									<div class="col-span-3 md:col-span-3"><input id="AUTO_FROM_TUESDAY" type="time" class="w-24 sm:w-28 text-center" /></div>
									<div class="col-span-3 md:col-span-3"><input id="AUTO_TO_TUESDAY" type="time" class="w-24 sm:w-28 text-center" /></div>
								</div>
								<!-- Mi√©rcoles -->
								<div class="grid grid-cols-12 items-center gap-2">
									<div class="col-span-4 md:col-span-3 text-sm">Mi√©rcoles</div>
									<div class="col-span-2 md:col-span-2"><input id="AUTO_DAYS_WEDNESDAY" type="checkbox" checked /></div>
									<div class="col-span-3 md:col-span-3"><input id="AUTO_FROM_WEDNESDAY" type="time" class="w-24 sm:w-28 text-center" /></div>
									<div class="col-span-3 md:col-span-3"><input id="AUTO_TO_WEDNESDAY" type="time" class="w-24 sm:w-28 text-center" /></div>
								</div>
								<!-- Jueves -->
								<div class="grid grid-cols-12 items-center gap-2">
									<div class="col-span-4 md:col-span-3 text-sm">Jueves</div>
									<div class="col-span-2 md:col-span-2"><input id="AUTO_DAYS_THURSDAY" type="checkbox" checked /></div>
									<div class="col-span-3 md:col-span-3"><input id="AUTO_FROM_THURSDAY" type="time" class="w-24 sm:w-28 text-center" /></div>
									<div class="col-span-3 md:col-span-3"><input id="AUTO_TO_THURSDAY" type="time" class="w-24 sm:w-28 text-center" /></div>
								</div>
								<!-- Viernes -->
								<div class="grid grid-cols-12 items-center gap-2">
									<div class="col-span-4 md:col-span-3 text-sm">Viernes</div>
									<div class="col-span-2 md:col-span-2"><input id="AUTO_DAYS_FRIDAY" type="checkbox" checked /></div>
									<div class="col-span-3 md:col-span-3"><input id="AUTO_FROM_FRIDAY" type="time" class="w-24 sm:w-28 text-center" /></div>
									<div class="col-span-3 md:col-span-3"><input id="AUTO_TO_FRIDAY" type="time" class="w-24 sm:w-28 text-center" /></div>
								</div>
								<!-- S√°bado -->
								<div class="grid grid-cols-12 items-center gap-2">
									<div class="col-span-4 md:col-span-3 text-sm">S√°bado</div>
									<div class="col-span-2 md:col-span-2"><input id="AUTO_DAYS_SATURDAY" type="checkbox" checked /></div>
									<div class="col-span-3 md:col-span-3"><input id="AUTO_FROM_SATURDAY" type="time" class="w-24 sm:w-28 text-center" /></div>
									<div class="col-span-3 md:col-span-3"><input id="AUTO_TO_SATURDAY" type="time" class="w-24 sm:w-28 text-center" /></div>
								</div>
								<!-- Domingo -->
								<div class="grid grid-cols-12 items-center gap-2">
									<div class="col-span-4 md:col-span-3 text-sm">Domingo</div>
									<div class="col-span-2 md:col-span-2"><input id="AUTO_DAYS_SUNDAY" type="checkbox" checked /></div>
									<div class="col-span-3 md:col-span-3"><input id="AUTO_FROM_SUNDAY" type="time" class="w-24 sm:w-28 text-center" /></div>
									<div class="col-span-3 md:col-span-3"><input id="AUTO_TO_SUNDAY" type="time" class="w-24 sm:w-28 text-center" /></div>
								</div>
							</div>
							<p class="text-xs text-slate-400 mt-1">Si el rango est√° vac√≠o, se considera todo el d√≠a. Si el fin es menor que el inicio, se interpreta como rango nocturno (p. ej. 22:00 a 02:00).</p>
						</div>
						
						<!-- Carpeta Remota para acci√≥n "remoto" -->
						<div class="mb-3 p-3 rounded-md border border-slate-700 bg-slate-800/40">
							<div class="text-sm font-semibold mb-2">Modo remoto (disparador por archivo)</div>
							<p class="text-xs text-slate-400 mb-2">Si habilitas el modo remoto, el sistema revisar√° peri√≥dicamente la carpeta configurada. Cuando encuentre un archivo <code>mp*.txt</code>, ejecutar√° el mismo proceso que "Descargar MP" y luego eliminar√° el archivo. √ötil para integraciones con otros sistemas que dejan un "disparador".</p>
							<div class="flex flex-col md:flex-row md:items-end gap-2 mb-2">
								<label class="block flex-1">Carpeta Remota
									<input id="AUTO_REMOTE_DIR" placeholder="C:\\tmp" />
								</label>
								<label class="block" style="min-width: 8rem;">
									<span>Intervalo remoto (ms)</span>
									<input id="AUTO_REMOTE_MS_INTERVAL" class="w-32 text-center" type="number" min="1" step="1" placeholder="60000" />
								</label>
							</div>
							<div class="grid grid-cols-1 md:grid-cols-2 gap-2 mb-2">
								<label class="checkbox inline-flex items-start gap-2 p-2 rounded border border-slate-700 bg-slate-900/30">
									<input id="AUTO_REMOTE_ENABLED" type="checkbox" />
									<span class="text-sm leading-5">
										Activar Modo Remoto<br>
										<span class="text-xs text-slate-400">Procesa archivos <code>mp*.txt</code> en la carpeta remota.</span>
									</span>
								</label>
								<label class="checkbox inline-flex items-start gap-2 p-2 rounded border border-slate-700 bg-slate-900/30">
									<input id="AUTO_REMOTE_WATCH" type="checkbox" />
									<span class="text-sm leading-5">
										Disparo inmediato por FTP (sin intervalo)<br>
										<span class="text-xs text-slate-400">Reacciona apenas llega el archivo. Deshabilita el uso de "Intervalo remoto".</span>
									</span>
								</label>
							</div>
							<button type="button" id="btnTestRemote" class="ml-2 text-xs px-2 py-1 rounded border border-slate-600 hover:bg-slate-700">Probar remoto ahora</button>
							<div class="text-xs text-slate-400 mt-2">El modo remoto respeta los <strong>d√≠as</strong> y <strong>horarios</strong> configurados arriba. Si defines un <strong>intervalo remoto (ms)</strong>, usar√° ese valor (sugerido: 60000 ms).<br><span class="text-amber-300">Cuando est√° activado "Disparo inmediato por FTP (sin intervalo)", al llegar <code>mp*.txt</code> se procesa <strong>siempre</strong> (ignora d√≠as/horas) y el env√≠o de <code>mp.dbf</code> por FTP se realiza en <strong>modo forzado</strong> (no se salta por "sin cambios").</span></div>
						</div>


						
						<div class="row">
							<button type="button" id="btnAutoStart">Activar</button>
							<button type="button" id="btnAutoStop">Desactivar</button>
							<span id="autoStatus"></span>
						</div>
					</div>
				</details>

				<details class="group mb-4 border border-slate-700 rounded-md">
					<summary class="cursor-pointer px-3 py-2 bg-slate-800 rounded-t-md text-sm font-semibold select-none">
						üì∑ Modo Imagen
					</summary>
					<div class="p-3 space-y-3">
						<p class="text-xs text-slate-400">El modo imagen permite visualizar autom√°ticamente contenido (im√°genes, PDFs, audio, video) cuando se detecta un archivo de control.</p>
						<div class="grid grid-cols-1 md:grid-cols-2 gap-3">
							<label class="block">Carpeta de control
								<input id="IMAGE_CONTROL_DIR" placeholder="C:\\tmp" />
							</label>
							<label class="block">Archivo de control
								<input id="IMAGE_CONTROL_FILE" placeholder="direccion.txt" />
							</label>
							<label class="checkbox inline-flex items-start gap-2 p-2 rounded border border-slate-700 bg-slate-900/30">
								<input id="IMAGE_WINDOW_SEPARATE" type="checkbox" />
								<span class="text-sm leading-5">
													Forzar ventana separada (cajero + imagen)
				<br><span class="text-xs text-slate-400">Si est√° tildado, el contenido siempre se abrir√° en una <strong>ventana separada</strong> (modo <code>nueva</code>), permitiendo que el cajero tenga abierto tanto el modo caja como el modo imagen en ventanas separadas simult√°neamente. Si no est√° tildado, respeta el <code>VENTANA=nueva</code> del archivo de control.</span>
								</span>
							</label>
						</div>
						<label class="checkbox inline-flex items-start gap-2 p-2 rounded border border-slate-700 bg-slate-900/30">
							<input id="IMAGE_WATCH" type="checkbox" />
							<span class="text-sm leading-5">
								Disparo inmediato por FTP (sin intervalo)
								<br><span class="text-xs text-slate-400">Muestra el contenido ni bien llega el <code>direccion.txt</code>.</span>
							</span>
						</label>
						<label class="checkbox inline-flex items-start gap-2 p-2 rounded border border-slate-700 bg-slate-900/30">
							<input id="IMAGE_PUBLICIDAD_ALLOWED" type="checkbox" />
							<span class="text-sm leading-5">
								Modo Publicidad (pantalla completa para ventana espejo)
								<br><span class="text-xs text-slate-400">Habilita el control "Publicidad" en el men√∫ del icono de bandeja. Si est√° tildado all√≠, la ventana espejo abrir√° en <strong>pantalla completa</strong> (estilo F11).</span>
							</span>
						</label>
						<div class="grid grid-cols-1 md:grid-cols-2 gap-2">
							<label class="checkbox inline-flex items-start gap-2 p-2 rounded border border-slate-700 bg-slate-900/30">
								<input id="IMAGE_PRODUCTO_NUEVO_ENABLED" type="checkbox" />
								<span class="text-sm leading-5">
									Producto nuevo (enfriamiento VENTANA=nueva)
									<br><span class="text-xs text-slate-400">Si llegan muchas solicitudes seguidas de <code>VENTANA=nueva</code>, reutiliza la √∫ltima ventana y solo refresca el contenido.</span>
								</span>
							</label>
							<div class="flex items-center gap-3 flex-wrap">
								<label class="inline-flex items-center gap-2 text-sm whitespace-nowrap">
									<span>Intervalo de enfriamiento (seg)</span>
									<input id="IMAGE_PRODUCTO_NUEVO_WAIT_SECONDS" type="number" class="w-24 text-center" placeholder="10" min="1" step="1" />
								</label>
								<button type="button" id="btnTestImage" class="px-3 py-1.5 text-sm rounded-md bg-emerald-600 text-white border-0 hover:bg-emerald-500">Probar lectura ahora</button>
							</div>
						</div>
						<p class="text-xs text-slate-400">Soporta: JPG, PNG, GIF, PDF, MP3, WAV, MP4, etc. Con "Disparo inmediato" activo se procesa siempre (ignora d√≠as/horas).</p>
					</div>
				</details>



				<details class="group mb-4 border border-slate-700 rounded-md">
					<summary class="cursor-pointer px-3 py-2 bg-slate-800 rounded-t-md text-sm font-semibold select-none">
						Seguridad
					</summary>
					<div class="p-3 space-y-3">
						<div>
							<label class="block text-sm mb-1">Contrase√±a actual</label>
							<div class="flex items-center gap-2 w-full">
								<input id="current-password" type="password" placeholder="Ingrese su contrase√±a actual" class="flex-1" />
								<button type="button" id="btnToggleCurrentPw" class="px-2 py-1 text-xs rounded border border-slate-600 hover:bg-slate-700 whitespace-nowrap">üëÅ Mostrar</button>
							</div>
						</div>

						<div>
							<label class="block text-sm mb-1">Nueva contrase√±a</label>
							<div class="flex items-center gap-2 w-full">
								<input id="new-password" type="password" placeholder="M√≠nimo 8 caracteres, 1 may√∫scula, 1 n√∫mero" class="flex-1" />
								<button type="button" id="btnToggleNewPw" class="px-2 py-1 text-xs rounded border border-slate-600 hover:bg-slate-700 whitespace-nowrap">üëÅ Mostrar</button>
							</div>
							<p class="text-xs text-slate-500 mt-1">Debe contener al menos 8 caracteres, una may√∫scula y un n√∫mero.</p>
						</div>

						<div>
							<label class="block text-sm mb-1">Confirmar nueva contrase√±a</label>
							<div class="flex items-center gap-2 w-full">
								<input id="confirm-password" type="password" placeholder="Repita la nueva contrase√±a" class="flex-1" />
								<button type="button" id="btnToggleConfirmPw" class="px-2 py-1 text-xs rounded border border-slate-600 hover:bg-slate-700 whitespace-nowrap">üëÅ Mostrar</button>
							</div>
						</div>
						<label>Nuevo usuario (opcional) <input id="new-username" placeholder="Dejar vac√≠o para mantener el actual" /></label>
						<label>Nueva frase secreta (opcional) <input id="new-secret-phrase" placeholder="Dejar vac√≠o para mantener la actual" /></label>
						<div class="row">
							<button type="button" id="btnChangePassword">Cambiar contrase√±a</button>
							<span id="passwordChangeStatus"></span>
						</div>
					</div>
				</details>



				<details class="group mb-4 border border-slate-700 rounded-md">
					<summary class="cursor-pointer px-3 py-2 bg-slate-800 rounded-t-md text-sm font-semibold select-none">
						üö® Notificaciones de Error
					</summary>
					<div class="p-3 space-y-3">
						<div class="flex items-center space-x-2">
							<input type="checkbox" id="error-notifications-enabled" class="w-4 h-4 text-blue-600 bg-gray-700 border-gray-600 rounded focus:ring-blue-500">
							<label for="error-notifications-enabled" class="text-sm">Habilitar notificaciones de error por email</label>
						</div>
						
						<div class="grid grid-cols-2 gap-4">
							<label class="text-sm">
								M√≠nimo errores antes de notificar
								<input id="min-errors-before-notify" type="number" min="1" max="10" step="1" placeholder="3" class="w-full px-2 py-1 bg-gray-700 border border-gray-600 rounded text-sm" />
							</label>
							<label class="text-sm">
								Tiempo entre notificaciones (minutos)
								<input id="min-time-between-notifications" type="number" min="15" max="1440" step="5" placeholder="60" class="w-full px-2 py-1 bg-gray-700 border border-gray-600 rounded text-sm" />
							</label>
						</div>

						<div class="bg-gray-800 p-3 rounded text-sm">
							<div class="flex justify-between items-center mb-2">
								<span class="font-semibold">üìä Estado Actual:</span>
								<button type="button" id="btnRefreshErrorSummary" class="text-xs text-blue-400 hover:text-blue-300" title="Actualizar resumen">Actualizar</button>
							</div>
							<div id="error-summary" class="space-y-1 text-xs">
								<div>‚Ä¢ Errores totales: <span id="total-errors">-</span></div>
								<div>‚Ä¢ Grupos activos: <span id="active-groups">-</span></div>
								<div>‚Ä¢ Notificaciones enviadas: <span id="notifications-sent">-</span></div>
							</div>
						</div>

						<div class="flex space-x-2">
							<button type="button" id="btnSaveErrorNotifications" class="px-3 py-1 bg-blue-600 hover:bg-blue-700 text-white text-sm rounded" title="Guardar configuraci√≥n">üíæ Guardar Configuraci√≥n</button>
							<button type="button" id="btnClearOldErrors" class="px-3 py-1 bg-yellow-600 hover:bg-yellow-700 text-white text-sm rounded" title="Eliminar errores de m√°s de 24h">üßπ Limpiar Errores Antiguos</button>
							<button type="button" id="btnResetErrorNotifications" class="px-3 py-1 bg-red-600 hover:bg-red-700 text-white text-sm rounded" title="Borrar todos los registros y contadores">üîÑ Resetear Todo</button>
						</div>
						
						<div id="error-notifications-status" class="text-sm"></div>
					</div>
				</details>

				<!-- Acciones principales (debajo de todas las secciones) -->
				<div class="actions-row mt-4 flex flex-wrap items-center gap-2">
					<button type="button" id="btnLoad" title="Leer configuraci√≥n desde disco">üìÇ Cargar configuraci√≥n</button>
					<button type="button" id="btnSave" title="Guardar configuraci√≥n de todos los paneles">üíæ Guardar configuraci√≥n</button>
					<button type="button" id="btnGenerate" title="Generar reporte con la configuraci√≥n actual">üìä Generar reporte</button>
					<button type="button" id="btnSendDbfFtp" title="Enviar el archivo mp.dbf por FTP">üì§ Enviar DBF por FTP</button>
					<button type="button" id="btnClearFtpHash" title="Limpiar hash FTP para forzar pr√≥ximo env√≠o">üßπ Limpiar Hash FTP</button>
				</div>
				
				<!-- Controles de vista previa -->
				<div class="mt-4">
					<div>
						<h3 class="m-0 text-sm font-semibold text-slate-200">Vista previa no sensible</h3>
						<p class="mt-1 text-xs text-slate-400">Muestra una copia de la configuraci√≥n guardada; los campos sensibles se ofuscan.</p>
					</div>
					<div class="mt-2 p-2 rounded border border-slate-700 bg-slate-800/40 flex flex-wrap items-center gap-2">
						<input id="previewFilter" placeholder="Filtrar por texto (ej. FTP_)" class="px-2 py-1 text-xs bg-slate-800 border border-slate-600 rounded md:w-64 flex-1" />
						<button type="button" id="btnPreviewCopy" class="inline-flex items-center gap-1 whitespace-nowrap px-2 py-1 text-xs rounded border border-slate-600 hover:bg-slate-700" title="Copiar JSON de la vista previa">üìã <span>Copiar</span></button>
						<button type="button" id="btnPreviewDownload" class="inline-flex items-center gap-1 whitespace-nowrap px-2 py-1 text-xs rounded border border-slate-600 hover:bg-slate-700" title="Descargar JSON (vista previa)">üíæ <span>Descargar .json</span></button>
						<button type="button" id="btnPreviewRestore" class="inline-flex items-center gap-1 whitespace-nowrap px-2 py-1 text-xs rounded border border-slate-600 hover:bg-slate-700" title="Restaurar configuraci√≥n desde un JSON">‚§¥Ô∏è <span>Restaurar</span></button>
						<input id="previewRestoreFile" type="file" accept="application/json,.json" class="hidden" />
						<button type="button" id="btnPreviewExpand" class="inline-flex items-center gap-1 whitespace-nowrap px-2 py-1 text-xs rounded border border-slate-600 hover:bg-slate-700" title="Expandir/contraer alto">‚§¢ <span>Expandir</span></button>
						<button type="button" id="btnPreviewToggle" class="inline-flex items-center gap-1 whitespace-nowrap px-2 py-1 text-xs rounded border border-slate-600 hover:bg-slate-700" title="Mostrar/Ocultar vista">üëÅ <span>Ocultar</span></button>
					</div>
				</div>
				<pre id="preview" class="mt-2 bg-slate-900 border border-slate-700 rounded p-3 text-xs h-64 overflow-auto"></pre>
			</form>

			<!-- Modal Editor de Perfil -->
			<div id="perfilEditorModal" class="fixed inset-0 bg-black/60 hidden items-center justify-center z-50">
				<div class="bg-slate-800 border border-slate-700 rounded-lg shadow-xl w-full max-w-2xl p-4">
					<div class="flex items-center justify-between mb-3">
						<h3 id="perfilEditTitle" class="text-sm font-semibold">Editar perfil</h3>
						<button type="button" id="perfilEditClose" class="px-2 py-1 text-xs rounded border border-slate-600 hover:bg-slate-700">‚úï</button>
					</div>
					<div class="space-y-3">
						<label class="block text-sm">Nombre
							<input id="perfilEditNombre" />
						</label>
						<div class="grid grid-cols-2 md:grid-cols-5 gap-2">
							<label class="checkbox inline-flex items-center gap-2"><input id="perm_facturacion" type="checkbox" /> Facturaci√≥n</label>
							<label class="checkbox inline-flex items-center gap-2"><input id="perm_caja" type="checkbox" /> Caja</label>
							<label class="checkbox inline-flex items-center gap-2"><input id="perm_administracion" type="checkbox" /> Administraci√≥n</label>
							<label class="checkbox inline-flex items-center gap-2"><input id="perm_configuracion" type="checkbox" /> Configuraci√≥n</label>
							<label class="checkbox inline-flex items-center gap-2"><input id="perm_consulta" type="checkbox" /> Consulta</label>
						</div>
						<div class="flex items-center justify-between">
							<div class="text-xs text-slate-400">Par√°metros (JSON)</div>
							<div class="flex items-center gap-2">
								<button type="button" id="perfilParamsFromConfig" class="px-2.5 py-1 text-xs rounded border border-slate-600 hover:bg-slate-700">Cargar desde configuraci√≥n (Imagen + FTP Server)</button>
								<button type="button" id="perfilParamsClear" class="px-2.5 py-1 text-xs rounded border border-slate-600 hover:bg-slate-700">Limpiar</button>
							</div>
						</div>
						<textarea id="perfilEditParams" class="w-full h-48 bg-slate-900 border border-slate-700 rounded p-2 text-xs"></textarea>
						<div class="flex items-center justify-end gap-2">
							<button type="button" id="perfilEditCancel" class="px-3 py-1.5 text-sm rounded border border-slate-600 hover:bg-slate-700">Cancelar</button>
							<button type="button" id="perfilEditSave" class="px-3 py-1.5 text-sm rounded bg-emerald-600 text-white border-0 hover:bg-emerald-500">Guardar</button>
						</div>
					</div>
				</div>
			</div>
        </section>

        <section id="tab-about" class="tab-pane">
				<div class="grid grid-cols-1 md:grid-cols-2 gap-6">
					<div>
						<p class="font-semibold">Informaci√≥n de contacto por fallas</p>
						<p>Servicio t√©cnico ‚Äì Todo-Computaci√≥n</p>
						<ul class="space-y-1">
							<li>Tel√©fono: 0261 4201555 int. 2</li>
							<li>WhatsApp: 26154669355</li>
							<li>Email: <a class="text-blue-300 hover:underline" href="mailto:pc@tcmza.com.ar">pc@tcmza.com.ar</a></li>
						</ul>
					</div>
					<div>
						<p class="text-sm text-slate-300 mb-2">Versiones</p>
						<div class="border border-slate-700 rounded-md bg-slate-800/40">
							<div class="flex items-center justify-between px-3 py-2 border-b border-slate-700">
								<h4 class="text-sm font-semibold">Notas de versi√≥n</h4>
								<div class="flex items-center gap-2">
									<button id="btnReleaseExpandAll" class="px-2 py-1 text-xs rounded border border-slate-600 hover:bg-slate-700" title="Expandir todas">‚§¢ Expandir</button>
									<button id="btnReleaseCollapseAll" class="px-2 py-1 text-xs rounded border border-slate-600 hover:bg-slate-700" title="Contraer todas">‚§° Contraer</button>
									<button id="btnRefreshReleaseNotes" class="px-2 py-1 text-xs rounded border border-slate-600 hover:bg-slate-700" title="Recargar notas desde archivo">‚Üª Recargar</button>
								</div>
							</div>
							<div class="p-3">
								<div id="release-notes-list" class="space-y-2"></div>
								<p class="mt-2 text-[11px] text-slate-400">Las notas se leen desde <code>docs/RELEASE_NOTES.md</code> y son de solo lectura. Se muestran agrupadas por versi√≥n.</p>
							</div>
						</div>
					</div>
			</section>

        <section id="tab-results" class="tab-pane">
			<div class="filters">
				<div class="row"><strong>Filtros</strong></div>
				<div class="row">
                <input id="filter_from" placeholder="Desde (YYYY-MM-DD)" />
                <input id="filter_to" placeholder="Hasta (YYYY-MM-DD)" />
                <select id="filter_status">
                    <option value="">Todos</option>
                    <option value="approved">approved</option>
                    <option value="refunded">refunded</option>
                    <option value="cancelled">cancelled</option>
                </select>
                <input id="quick_search" placeholder="Buscar por texto..." />
                <button id="btnGenerateRange">Generar (rango)</button>
                <button id="btnResetFilters" title="Restablecer filtros">Reset</button>
				</div>
			</div>
            <div class="row">
                <div class="summary">
                    <strong>Ingresos:</strong> <span id="summaryIncomes">0.00</span>
                    <strong class="ml-4">Devoluciones:</strong> <span id="summaryRefunds">0.00</span>
                    <strong class="ml-4">Neto:</strong> <span id="summaryTotal">0.00</span>
                </div>
                <div class="ml-auto">
                    <label for="pageSize">Filas por p√°gina</label>
                    <select id="pageSize">
                        <option value="10">10</option>
                        <option value="20" selected>20</option>
                        <option value="50">50</option>
                        <option value="100">100</option>
                    </select>
                </div>
            </div>
            <div class="row">
                <button id="btnExportCSV" title="Exportar CSV (curado)">CSV</button>
                <button id="btnExportXLSX" title="Exportar Excel (full)">XLSX</button>
                <button id="btnExportDBF" title="Exportar DBF (detalle)">DBF</button>
                <button id="btnExportJSON" title="Exportar resumen JSON">JSON</button>
                <button id="btnSendEmail" title="Enviar por email los archivos del d√≠a">Enviar por email</button>
            </div>
            <table id="resultsTable">
                <thead>
                    <tr>
                        <th>ID pago</th>
                        <th>Estado</th>
                        <th>Monto</th>
                        <th>Fecha</th>
                        <th>M√©todo de pago</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
            <div class="row">
                <button id="prevPage">Prev</button>
                <span id="pageInfo"></span>
                <button id="nextPage">Next</button>
            </div>
        </section>

        <section id="tab-history" class="tab-pane">
            <div class="row">
                <button id="btnRefreshHistory">Actualizar historial</button>
                <button id="btnOpenOutDir">Abrir carpeta de reportes</button>
            </div>
            <ul id="historyList"></ul>
        </section>
    </div>
    <div id="toast" class="fixed bottom-4 right-4 hidden px-4 py-2 rounded bg-slate-800 border border-slate-700"></div>
    <script>
    // Fallback si no existe nombre_tc.png ‚Üí mostrar texto
    (function ensureBrand(){
        const img = document.getElementById('brandLogo');
        if (!img) return;
        img.addEventListener('error', () => {
            const h1 = document.createElement('h1');
            h1.textContent = 'TODO-COMPUTACION';
            const parent = img.parentElement;
            if (parent) parent.replaceChild(h1, img);
        }, { once: true });
    })();
    document.getElementById('btnOpenCaja')?.addEventListener('click', async () => {
        console.log('[UI] Modo Caja: click capturado');
        try {
            const toast = document.getElementById('toast');
            if (toast) { toast.textContent = 'Abriendo Modo Caja...'; toast.classList.remove('hidden'); setTimeout(()=>toast.classList.add('hidden'), 1500); }
        } catch {}
        try {
            if (window.api && typeof window.api.openView === 'function') {
                console.log('[UI] Llamando window.api.openView("caja")');
                await window.api.openView('caja');
                console.log('[UI] openView resuelto');
                return;
            }
        } catch {}
        // Fallback directo por si IPC no est√° disponible en dev
        console.warn('[UI] Fallback: navegando directo a caja.html');
        window.location.href = 'caja.html';
    });
    document.getElementById('btnOpenImagen')?.addEventListener('click', async () => {
        console.log('[UI] Modo Imagen: click capturado');
        try {
            const toast = document.getElementById('toast');
            if (toast) { toast.textContent = 'Abriendo Modo Imagen...'; toast.classList.remove('hidden'); setTimeout(()=>toast.classList.add('hidden'), 1500); }
        } catch {}
        try {
            if (window.api && typeof window.api.openView === 'function') {
                console.log('[UI] Llamando window.api.openView("imagen")');
                await window.api.openView('imagen');
                console.log('[UI] openView resuelto');
                return;
            }
        } catch {}
        // Fallback directo por si IPC no est√° disponible en dev
        console.warn('[UI] Fallback: navegando directo a imagen.html');
        window.location.href = 'imagen.html';
    });
    document.getElementById('btnOpenLogs')?.addEventListener('click', async () => {
        if (window.api && typeof window.api.openTodayLog === 'function') {
            await window.api.openTodayLog();
        }
    });

    // ===== HANDLERS GALICIA =====
    
    // Toggle mostrar/ocultar clave Galicia
    document.getElementById('btnToggleGaliciaKey')?.addEventListener('click', () => {
        const input = document.getElementById('GALICIA_APP_KEY');
        const button = document.getElementById('btnToggleGaliciaKey');
        if (input.type === 'password') {
            input.type = 'text';
            button.textContent = 'üôà Ocultar';
        } else {
            input.type = 'password';
            button.textContent = 'üëÅ Mostrar';
        }
    });

    // Probar conexi√≥n Galicia
    document.getElementById('btnTestGalicia')?.addEventListener('click', async () => {
        const statusEl = document.getElementById('galiciaTestStatus');
        const button = document.getElementById('btnTestGalicia');
        
        if (statusEl) statusEl.textContent = 'Probando...';
        if (button) button.disabled = true;
        
        try {
            const result = await window.api.galicia.testConnection();
            if (statusEl) {
                statusEl.textContent = result.success ? '‚úÖ Conexi√≥n exitosa' : `‚ùå ${result.message}`;
                statusEl.className = result.success ? 'text-green-400' : 'text-red-400';
            }
        } catch (error) {
            if (statusEl) {
                statusEl.textContent = `‚ùå Error: ${error.message}`;
                statusEl.className = 'text-red-400';
            }
        } finally {
            if (button) button.disabled = false;
        }
    });

    // Abrir m√≥dulo Galicia
    document.getElementById('btnOpenGalicia')?.addEventListener('click', async () => {
        try {
            const toast = document.getElementById('toast');
            if (toast) { 
                toast.textContent = 'Abriendo m√≥dulo Galicia...'; 
                toast.classList.remove('hidden'); 
                setTimeout(()=>toast.classList.add('hidden'), 1500); 
            }
            
            // Cargar galicia.html en la ventana principal
            if (window.api && typeof window.api.openView === 'function') {
                await window.api.openView('galicia');
            } else {
                // Fallback directo
                window.location.href = 'galicia.html';
            }
        } catch (error) {
            console.error('Error al abrir m√≥dulo Galicia:', error);
        }
    });
    // Mostrar versi√≥n instalada
    (async () => {
        try {
            if (window.api && typeof window.api.getAppVersion === 'function') {
                const res = await window.api.getAppVersion();
                const el = document.getElementById('app-version');
                if (el && res && res.version) el.textContent = res.version;
            }
        } catch {}
    })();

    // ===== Fac Watcher (UI) =====
    (function setupFacWatcherUI(){
        try {
            const dirInput = document.getElementById('FAC_WATCH_DIR');
            const enabledInput = document.getElementById('FAC_WATCH_ENABLED');
            const btnSave = document.getElementById('btnFacWatcherSave');
            const statusEl = document.getElementById('facWatcherStatus');
            const logEl = document.getElementById('facWatcherLog');
            if (!dirInput || !enabledInput || !btnSave) return;

            // Cargar estado
            (async()=>{
                try {
                    const res = await window.api.facturacion.getWatcherDir();
                    if (res?.ok) {
                        if (typeof res.dir === 'string') dirInput.value = res.dir;
                        enabledInput.checked = !!res.enabled;
                    }
                } catch {}
            })();

            btnSave.addEventListener('click', async () => {
                try {
                    statusEl.textContent = 'Guardando...';
                    const res = await window.api.facturacion.setWatcherDir(dirInput.value, enabledInput.checked);
                    statusEl.textContent = res?.ok ? '‚úÖ Guardado' : `‚ùå ${(res && res.error) || 'Error'}`;
                } catch (e) {
                    statusEl.textContent = `‚ùå ${e && e.message ? e.message : 'Error'}`;
                }
            });

            // Mostrar detecciones en log de depuraci√≥n
            try {
                window.api.facturacion.onFacDetected?.(({ filename, rawContent }) => {
                    try { logEl.classList.remove('hidden'); } catch {}
                    const ts = new Date().toISOString();
                    const msg = `[${ts}] DETECTADO: ${filename}\n${rawContent}\n---\n`;
                    logEl.textContent = (logEl.textContent || '') + msg;
                    logEl.scrollTop = logEl.scrollHeight;
                    console.log('[fac] detectado', { filename, rawLength: (rawContent||'').length });
                });
            } catch {}
        } catch {}
    })();

    // ===== Recibo Config (PV y contador) =====
    (async function setupReciboUI(){
        try {
            const pvEl = document.getElementById('REC_PV');
            const niEl = document.getElementById('REC_NI');
            const nextEl = document.getElementById('REC_NEXT');
            const btn = document.getElementById('btnReciboGuardar');
            const status = document.getElementById('reciboStatus');
            if (!pvEl || !niEl || !nextEl || !btn) return;
            const res = await window.api.recibo.getConfig();
            if (res?.ok && res.config) {
                pvEl.value = String(res.config.pv ?? 1);
                niEl.value = String(res.config.contador ?? 1);
                nextEl.value = `${String(res.config.pv ?? 1).padStart(4,'0')} - ${String(res.config.contador ?? 1).padStart(8,'0')}`;
                const outLocal = document.getElementById('REC_OUT_LOCAL');
                const outRed1 = document.getElementById('REC_OUT_RED1');
                const outRed2 = document.getElementById('REC_OUT_RED2');
                if (outLocal) outLocal.value = res.config.outLocal || '';
                if (outRed1) outRed1.value = res.config.outRed1 || '';
                if (outRed2) outRed2.value = res.config.outRed2 || '';

                // Cargar impresoras disponibles
                try {
                    const list = await window.api.printers.list();
                    const sel = document.getElementById('REC_PRINTER');
                    if (sel && list?.ok) {
                        sel.innerHTML = '';
                        const optDef = document.createElement('option');
                        optDef.value = '';
                        optDef.textContent = '(predeterminada del sistema)';
                        sel.appendChild(optDef);
                        for (const p of (list.printers || [])) {
                            const o = document.createElement('option');
                            o.value = p.name;
                            o.textContent = p.name + (p.isDefault ? ' (predeterminada)' : '');
                            sel.appendChild(o);
                        }
                    }
                } catch {}
            }
            btn.addEventListener('click', async () => {
                try {
                    if (status) status.textContent = 'Guardando...';
                    const outLocalEl = document.getElementById('REC_OUT_LOCAL');
                    const outRed1El = document.getElementById('REC_OUT_RED1');
                    const outRed2El = document.getElementById('REC_OUT_RED2');
                    const payload = {
                        pv: Number(pvEl.value || '1'),
                        contador: Number(niEl.value || '1'),
                        outLocal: outLocalEl ? outLocalEl.value : undefined,
                        outRed1: outRed1El ? outRed1El.value : undefined,
                        outRed2: outRed2El ? outRed2El.value : undefined,
                    };
                    const save = await window.api.recibo.saveConfig(payload);
                    if (save?.ok) {
                        if (status) status.textContent = '‚úÖ Guardado';
                        nextEl.value = `${String(payload.pv).padStart(4,'0')} - ${String(payload.contador).padStart(8,'0')}`;
                    } else {
                        if (status) status.textContent = `‚ùå ${(save && save.error) || 'Error'}`;
                    }
                } catch (e) {
                    if (status) status.textContent = `‚ùå ${e && e.message ? e.message : 'Error'}`;
                }
            });

            // Test impresi√≥n (diagn√≥stico)
            const btnTest = document.getElementById('btnReciboTestPrint');
            if (btnTest) btnTest.addEventListener('click', async () => {
                try {
                    alert('La impresi√≥n autom√°tica se realizar√° luego de generar el PDF desde .fac seg√∫n COPIAS:. Este bot√≥n es informativo.');
                } catch {}
            });
        } catch {}
    })();

    // ===== Remito Config (PV y contador) =====
    (async function setupRemitoUI(){
        try {
            const printers = await window.api.printers.list().catch(() => ({ ok:false, printers: [] }));
            const sel = document.getElementById('REM_PRINTER');
            if (sel && printers && Array.isArray(printers.printers)) {
                sel.innerHTML = '<option value="">(predeterminada del sistema)</option>' + printers.printers.map((p)=>`<option value="${(p.name||'').replace(/"/g,'&quot;')}">${p.name||''}</option>`).join('');
            }
        } catch {}

        const btn = document.getElementById('btnRemitoGuardar');
        const status = document.getElementById('remitoStatus');
        try {
            const res = await window.api.remito.getConfig();
            const cfg = (res && res.config) || {};
            const setVal = (id, v) => { const el = document.getElementById(id); if (el) el.value = (v ?? ''); };
            setVal('REM_PV', cfg.pv);
            setVal('REM_NI', cfg.contador);
            setVal('REM_OUT_LOCAL', cfg.outLocal);
            setVal('REM_OUT_RED1', cfg.outRed1);
            setVal('REM_OUT_RED2', cfg.outRed2);
            const next = Number(cfg.contador || 0);
            setVal('REM_NEXT', String(next).padStart(8,'0'));
            if (cfg.printerName) {
                const sel2 = document.getElementById('REM_PRINTER');
                if (sel2) sel2.value = String(cfg.printerName);
            }
        } catch {}

        if (btn) btn.addEventListener('click', async () => {
            try { if (status) status.textContent = 'Guardando...'; } catch {}
            try {
                const getVal = (id)=>{ const el = document.getElementById(id); return el ? (el.value ?? '') : ''; };
                const payload = {
                    pv: Number(getVal('REM_PV')||'0')||0,
                    contador: Number(getVal('REM_NI')||'0')||0,
                    outLocal: getVal('REM_OUT_LOCAL'),
                    outRed1: getVal('REM_OUT_RED1'),
                    outRed2: getVal('REM_OUT_RED2')
                };
                const printerName = getVal('REM_PRINTER');
                if (printerName) payload.printerName = printerName;
                const save = await window.api.remito.saveConfig(payload);
                if (save && save.ok) {
                    if (status) status.textContent = '‚úÖ Guardado';
                } else {
                    if (status) status.textContent = `‚ùå ${(save && save.error) || 'Error'}`;
                }
            } catch (e) {
                if (status) status.textContent = `‚ùå ${e && e.message ? e.message : 'Error'}`;
            }
        });
    })();

    // ... existing code ...
    // Cargar estado (a√±adir WhatsApp FTP)
    (async function loadFtpWhatsapp(){
        try {
            const res = await window.api.getConfig();
            const cfg = res || {};
            const set = (id, val)=>{ const el=document.getElementById(id); if(el) el.value = val ?? ''; };
            const setChk = (id, val)=>{ const el=document.getElementById(id); if(el) el.checked = !!val; };
            set('FTP_WHATSAPP_IP', cfg.FTP_WHATSAPP_IP);
            set('FTP_WHATSAPP_PORT', cfg.FTP_WHATSAPP_PORT);
            set('FTP_WHATSAPP_USER', cfg.FTP_WHATSAPP_USER);
            set('FTP_WHATSAPP_PASS', cfg.FTP_WHATSAPP_PASS);
            setChk('FTP_WHATSAPP_SECURE', cfg.FTP_WHATSAPP_SECURE);
            setChk('FTP_WHATSAPP_SFTP', cfg.FTP_WHATSAPP_SFTP);
            set('FTP_WHATSAPP_DIR', cfg.FTP_WHATSAPP_DIR);
        } catch {}
    })();

    // Guardar configuraci√≥n (extender bot√≥n global)
    document.getElementById('btnSave')?.addEventListener('click', async () => {
        try {
            const getVal = (id)=>{ const el=document.getElementById(id); return el ? (el.value ?? '') : ''; };
            const getChk = (id)=>{ const el=document.getElementById(id); return el ? !!el.checked : false; };
			const payload = {
                FTP_WHATSAPP_IP: getVal('FTP_WHATSAPP_IP'),
                FTP_WHATSAPP_PORT: Number(getVal('FTP_WHATSAPP_PORT')||'21'),
                FTP_WHATSAPP_USER: getVal('FTP_WHATSAPP_USER'),
                FTP_WHATSAPP_PASS: getVal('FTP_WHATSAPP_PASS'),
                FTP_WHATSAPP_SECURE: false,
                FTP_WHATSAPP_SFTP: true,
                FTP_WHATSAPP_DIR: getVal('FTP_WHATSAPP_DIR'),
            };
			const base = await window.api.getConfig();
			await window.api.saveConfig({ ...(base||{}), ...payload });

			// Guardar tambi√©n FTP Mercado Pago
			await window.api.mpFtp.saveConfig({
				MP_FTP_IP: getVal('MP_FTP_IP'),
				MP_FTP_PORT: Number(getVal('MP_FTP_PORT')||'21'),
				MP_FTP_SECURE: getChk('MP_FTP_SECURE'),
				MP_FTP_USER: getVal('MP_FTP_USER'),
				MP_FTP_PASS: getVal('MP_FTP_PASS'),
				MP_FTP_DIR: getVal('MP_FTP_DIR'),
			});
        } catch {}
    });
	// Toggle mostrar/ocultar password FTP MP
	document.getElementById('btnToggleMpFtpPass')?.addEventListener('click', () => {
		const input = document.getElementById('MP_FTP_PASS');
		const button = document.getElementById('btnToggleMpFtpPass');
		if (!input || !button) return;
		if (input.type === 'password') { input.type = 'text'; button.textContent = 'üôà Ocultar'; }
		else { input.type = 'password'; button.textContent = 'üëÅ Mostrar'; }
	});

	// Cargar config FTP MP
	(async function loadMpFtp(){
		try {
			const res = await window.api.mpFtp.getConfig();
			const cfg = (res && res.config) || {};
			const set = (id, val)=>{ const el=document.getElementById(id); if(el) el.value = val ?? ''; };
			const setChk = (id, val)=>{ const el=document.getElementById(id); if(el) el.checked = !!val; };
			set('MP_FTP_IP', cfg.MP_FTP_IP);
			set('MP_FTP_PORT', cfg.MP_FTP_PORT ?? 21);
			setChk('MP_FTP_SECURE', cfg.MP_FTP_SECURE);
			set('MP_FTP_USER', cfg.MP_FTP_USER);
			set('MP_FTP_PASS', cfg.MP_FTP_PASS);
			set('MP_FTP_DIR', cfg.MP_FTP_DIR);
		} catch {}
	})();

	// Probar FTP MP
	document.getElementById('btnTestMpFtp')?.addEventListener('click', async () => {
		const statusEl = document.getElementById('ftpMpTestStatus');
		try { if (statusEl) statusEl.textContent = 'Probando...'; } catch {}
		try {
			const res = await window.api.mpFtp.test();
			if (statusEl) statusEl.textContent = res?.ok ? '‚úÖ Conexi√≥n exitosa' : `‚ùå ${(res && res.error) || 'Error'}`;
		} catch (e) {
			if (statusEl) statusEl.textContent = `‚ùå ${e && e.message ? e.message : 'Error'}`;
		}
	});

	// Enviar mp.dbf por FTP MP
	document.getElementById('btnSendMpDbf')?.addEventListener('click', async () => {
		const statusEl = document.getElementById('ftpMpTestStatus');
		try { if (statusEl) statusEl.textContent = 'Enviando mp.dbf...'; } catch {}
		try {
			const res = await window.api.mpFtp.sendMpDbf();
			if (statusEl) statusEl.textContent = res?.ok ? (res.skipped ? '‚ö†Ô∏è Sin cambios - omitido' : '‚úÖ Enviado') : `‚ùå ${(res && res.error) || 'Error'}`;
		} catch (e) {
			if (statusEl) statusEl.textContent = `‚ùå ${e && e.message ? e.message : 'Error'}`;
		}
	});

	// Guardar solo FTP MP
	document.getElementById('btnSaveMpFtp')?.addEventListener('click', async () => {
		const statusEl = document.getElementById('mpFtpSaveStatus');
		try { if (statusEl) statusEl.textContent = 'Guardando...'; } catch {}
		try {
			const getVal = (id)=>{ const el=document.getElementById(id); return el ? (el.value ?? '') : ''; };
			const getChk = (id)=>{ const el=document.getElementById(id); return el ? !!el.checked : false; };
			await window.api.mpFtp.saveConfig({
				MP_FTP_IP: getVal('MP_FTP_IP'),
				MP_FTP_PORT: Number(getVal('MP_FTP_PORT')||'21'),
				MP_FTP_SECURE: getChk('MP_FTP_SECURE'),
				MP_FTP_USER: getVal('MP_FTP_USER'),
				MP_FTP_PASS: getVal('MP_FTP_PASS'),
				MP_FTP_DIR: getVal('MP_FTP_DIR'),
			});
			if (statusEl) statusEl.textContent = '‚úÖ Guardado';
		} catch (e) { if (statusEl) statusEl.textContent = `‚ùå ${e && e.message ? e.message : 'Error'}`; }
	});

    // Toggle mostrar/ocultar password WhatsApp
    document.getElementById('btnToggleFtpWPass')?.addEventListener('click', () => {
        const input = document.getElementById('FTP_WHATSAPP_PASS');
        const button = document.getElementById('btnToggleFtpWPass');
        if (!input || !button) return;
        if (input.type === 'password') { input.type = 'text'; button.textContent = 'üôà Ocultar'; }
        else { input.type = 'password'; button.textContent = 'üëÅ Mostrar'; }
    });
    // Probar FTP WhatsApp
    document.getElementById('btnTestFtpWhatsapp')?.addEventListener('click', async () => {
        const statusEl = document.getElementById('ftpWhatsappTestStatus');
        try { if (statusEl) statusEl.textContent = 'Probando...'; } catch {}
        try {
            const res = await window.api.testFtpWhatsappConnection();
            if (statusEl) statusEl.textContent = res?.ok ? '‚úÖ Conexi√≥n exitosa' : `‚ùå ${(res && res.error) || 'Error'}`;
        } catch (e) {
            if (statusEl) statusEl.textContent = `‚ùå ${e && e.message ? e.message : 'Error'}`;
        }
    });

    // Guardar solo secci√≥n WhatsApp
    document.getElementById('btnSaveWhatsappCfg')?.addEventListener('click', async () => {
        const statusEl = document.getElementById('waSaveStatus');
        try { if (statusEl) statusEl.textContent = 'Guardando...'; } catch {}
        try {
            const getVal = (id)=>{ const el=document.getElementById(id); return el ? (el.value ?? '') : ''; };
            const payload = {
                FTP_WHATSAPP_IP: getVal('FTP_WHATSAPP_IP'),
                FTP_WHATSAPP_PORT: Number(getVal('FTP_WHATSAPP_PORT')||'21'),
                FTP_WHATSAPP_USER: getVal('FTP_WHATSAPP_USER'),
                FTP_WHATSAPP_PASS: getVal('FTP_WHATSAPP_PASS'),
                FTP_WHATSAPP_SECURE: false,
                FTP_WHATSAPP_SFTP: true,
                FTP_WHATSAPP_DIR: getVal('FTP_WHATSAPP_DIR'),
            };
            const base = await window.api.getConfig();
            await window.api.saveConfig({ ...(base||{}), ...payload });
            if (statusEl) statusEl.textContent = '‚úÖ Guardado';
        } catch (e) {
            if (statusEl) statusEl.textContent = `‚ùå ${e && e.message ? e.message : 'Error'}`;
        }
    });

    // Guardar solo FTP Cliente
    document.getElementById('btnSaveFtp')?.addEventListener('click', async () => {
        const statusEl = document.getElementById('ftpSaveStatus');
        try { if (statusEl) statusEl.textContent = 'Guardando...'; } catch {}
        try {
            const getVal = (id)=>{ const el=document.getElementById(id); return el ? (el.value ?? '') : ''; };
            const getChk = (id)=>{ const el=document.getElementById(id); return el ? !!el.checked : false; };
            const payload = {
                FTP_IP: getVal('FTP_IP'),
                FTP_PORT: Number(getVal('FTP_PORT')||'21'),
                FTP_USER: getVal('FTP_USER'),
                FTP_PASS: getVal('FTP_PASS'),
                FTP_SECURE: getChk('FTP_SECURE'),
                FTP_DIR: getVal('FTP_DIR')
            };
            const base = await window.api.getConfig();
            await window.api.saveConfig({ ...(base||{}), ...payload });
            if (statusEl) statusEl.textContent = '‚úÖ Guardado';
        } catch (e) {
            if (statusEl) statusEl.textContent = `‚ùå ${e && e.message ? e.message : 'Error'}`;
        }
    });

    // Enviar archivo manual a WhatsApp FTP
    document.getElementById('btnPickLocalFileWa')?.addEventListener('click', async () => {
        try {
            const input = document.createElement('input');
            input.type = 'file';
            input.onchange = () => {
                const file = input.files && input.files[0];
                if (file) {
                    const pathInput = document.getElementById('FTP_WA_SEND_FILE_PATH');
                    var chosenPath = file.name;
                    try { if (file && file.path) { chosenPath = file.path; } } catch {}
                    if (pathInput) { try { pathInput.value = chosenPath; } catch(e) { /* no-op */ } }
                }
            };
            input.click();
        } catch {}
    });
    document.getElementById('btnSendLocalFileWa')?.addEventListener('click', async () => {
        const pathInput = document.getElementById('FTP_WA_SEND_FILE_PATH');
        const statusEl = document.getElementById('ftpWhatsappTestStatus');
        var localPath = '';
        if (pathInput && pathInput.value) localPath = pathInput.value;
        if (!localPath) { if (statusEl) statusEl.textContent = '‚ùå Seleccione un archivo'; return; }
        try { if (statusEl) statusEl.textContent = 'Enviando...'; } catch {}
        try {
            const res = await window.api.ftpSendWhatsappFile(localPath);
            if (statusEl) statusEl.textContent = res?.ok ? '‚úÖ Enviado' : `‚ùå ${(res && res.error) || 'Error'}`;
        } catch (e) {
            if (statusEl) statusEl.textContent = `‚ùå ${e && e.message ? e.message : 'Error'}`;
        }
    });
    // ... existing code ...

    // ===== HANDLERS FACTURAS (A/B y Notas) =====
    (function setupFacturasAbPanel(){
      const selPrinter = document.getElementById('FAC_PRINTER');
      const btnLoad = document.getElementById('btnFacturasLoad');
      const btnSave = document.getElementById('btnFacturasSave');
      const btnTestPrint = document.getElementById('btnFacturasTestPrint');
      const btnPdfsRefresh = document.getElementById('btnFacturasPdfsRefresh');
      const ulPdfs = document.getElementById('listaPdfsFacturas');
      const btnOpenLocal = document.getElementById('btnOpenFacLocal');
      const btnOpenRed1 = document.getElementById('btnOpenFacRed1');
      const btnOpenRed2 = document.getElementById('btnOpenFacRed2');
      const statusEl = document.getElementById('facturasStatus');
      const getEl = (id) => document.getElementById(id);
      const setStatus = (msg, ok=true) => { if(statusEl){ statusEl.textContent = msg; statusEl.className = ok? 'text-emerald-400 text-xs' : 'text-red-400 text-xs'; } };

      async function loadPrinters(){
        try {
          if (!selPrinter || !window.api?.printers?.list) return;
          const res = await window.api.printers.list();
          const arr = Array.isArray(res) ? res : (Array.isArray(res?.printers) ? res.printers : []);
          selPrinter.innerHTML = '<option value="">(Sin impresora)</option>';
          for (const p of (arr||[])) {
            const name = (p && (p.name || p.displayName)) ? (p.name || p.displayName) : String(p || '');
            if (!name) continue;
            const opt = document.createElement('option');
            opt.value = name;
            opt.textContent = name;
            selPrinter.appendChild(opt);
          }
        } catch {}
      }

      async function loadConfig(){
        try {
          if (!window.api?.facturas?.getConfig) return;
          const res = await window.api.facturas.getConfig();
          const cfg = res?.config || res || {};
          getEl('FAC_OUT_LOCAL').value = cfg.outLocal ?? '';
          getEl('FAC_OUT_RED1').value = cfg.outRed1 ?? '';
          getEl('FAC_OUT_RED2').value = cfg.outRed2 ?? '';
          if (selPrinter && cfg.printerName) selPrinter.value = cfg.printerName;
          setStatus('Configuraci√≥n cargada', true);
          setTimeout(()=> setStatus(''), 2000);
        } catch (e) {
          setStatus('No se pudo cargar', false);
          setTimeout(()=> setStatus(''), 2500);
        }
      }

      async function saveConfig(){
        try {
          if (!window.api?.facturas?.saveConfig) return;
          const payload = {
            outLocal: getEl('FAC_OUT_LOCAL').value?.trim() || undefined,
            outRed1: getEl('FAC_OUT_RED1').value?.trim() || undefined,
            outRed2: getEl('FAC_OUT_RED2').value?.trim() || undefined,
            printerName: selPrinter?.value || undefined,
          };
          const res = await window.api.facturas.saveConfig(payload);
          if (res?.ok !== false) { setStatus('‚úÖ Guardado', true); setTimeout(()=> setStatus(''), 2000); }
          else { setStatus(`‚ùå Error al guardar: ${res?.error || 'Error'}`, false); setTimeout(()=> setStatus(''), 3000); }
        } catch (e) {
          setStatus(`‚ùå Error al guardar: ${e?.message || String(e) || 'Error'}`, false);
          setTimeout(()=> setStatus(''), 2500);
        }
      }

      async function refreshPdfs(){
        try {
          if (!ulPdfs || !window.api?.facturacion?.listarPdfs) return;
          const res = await window.api.facturacion.listarPdfs();
          const files = Array.isArray(res?.rows) ? res.rows : (Array.isArray(res) ? res : []);
          // Normalizar a objetos { path, mtimeMs?, size? }
          const norm = files.map((it)=>{
            if (typeof it === 'string') return { path: it };
            if (it && typeof it === 'object') return { path: it.path || it.file || it.name || '', mtimeMs: it.mtimeMs || it.mtime || it.time || undefined, size: it.size };
            return { path: String(it || '') };
          }).filter(f=>f.path);
          // Ordenar por mtime desc si est√° disponible, sino por nombre desc
          norm.sort((a,b)=>{
            if (typeof a.mtimeMs === 'number' && typeof b.mtimeMs === 'number') return b.mtimeMs - a.mtimeMs;
            return (b.path||'').localeCompare(a.path||'');
          });
          ulPdfs.innerHTML = '';
          for (const f of norm) {
            const li = document.createElement('li');
            const a = document.createElement('a');
            a.href = '#';
            const base = f.path.split(/[\\\/]/).pop();
            // Decorar con fecha/tama√±o si existen
            const when = (typeof f.mtimeMs === 'number') ? new Date(f.mtimeMs).toLocaleString('es-AR') : '';
            const sizeKb = (typeof f.size === 'number') ? ` ‚Ä¢ ${(f.size/1024).toFixed(0)} KB` : '';
            a.textContent = base + (when ? ` ‚Äî ${when}${sizeKb}` : '');
            a.title = f.path;
            a.addEventListener('click', async (ev)=>{ ev.preventDefault(); try { await window.api.facturacion.abrirPdf(f.path); } catch {} });
            li.appendChild(a);
            ulPdfs.appendChild(li);
          }
        } catch {}
      }

      async function testPrint(){
        try {
          if (!window.api?.printers?.printPdf) return;
          setStatus('Imprimiendo prueba...', true);
          // Usar el primer PDF disponible en la lista como prueba
          if (ulPdfs?.firstChild) {
            const a = ulPdfs.firstChild.querySelector('a');
            const file = a?.textContent || '';
            if (file) await window.api.printers.printPdf(file, selPrinter?.value || undefined, 1);
          }
        } catch {}
      }

      // Bind
      btnLoad?.addEventListener('click', loadConfig);
      btnSave?.addEventListener('click', saveConfig);
      btnPdfsRefresh?.addEventListener('click', refreshPdfs);
      btnTestPrint?.addEventListener('click', testPrint);

      async function openIf(pathStr){ try { if (pathStr && window.api?.openPath) await window.api.openPath(pathStr); } catch {} }
      btnOpenLocal?.addEventListener('click', ()=> openIf(get('FAC_OUT_LOCAL')?.value));
      btnOpenRed1?.addEventListener('click', ()=> openIf(get('FAC_OUT_RED1')?.value));
      btnOpenRed2?.addEventListener('click', ()=> openIf(get('FAC_OUT_RED2')?.value));

      // Init
      loadPrinters();
      loadConfig();
      refreshPdfs();
    })();
    // ===== HANDLERS GALICIA =====
// ... existing code ...
    </script>
    <script src="../dist/src/renderer.js"></script>
</body>
</html>
